"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[33],{15600:(e,t,n)=>{n.r(t),n.d(t,{default:()=>K});var r=n(80184),s=n(14182),i=n(18203),o=n(72791),a=n(4959),l=n(73485),d=n(87594),c=n(23098),u=n(61945),f=n(89242),m=n(38705),p=n(14316),h=n(98502),x=n(27127),v=n(5784),y=n(26503),j=n(47712),g=n(68827),w=n(91153);const b=e=>{let{onBack:t,onClose:n}=e;return(0,r.jsxs)(f.hy,{children:[(0,r.jsx)(g.z,{onClick:t,children:(0,r.jsx)(v.wy,{})}),(0,r.jsx)(f.Ho,{handleClose:n})]})},T=e=>{let{nftItem:t}=e;const{t:n}=(0,u.$G)(),s=(0,c._)(),i=(0,w.i7)();return(0,r.jsxs)(y.L8,{fullWidth:!0,children:[t.collection&&(0,r.jsx)(y.HC,{onClick:()=>s.copyToClipboard((0,x.Tg)(t.collection.address,i,!0)),children:(0,r.jsxs)(y.me,{children:[(0,r.jsx)(h.__,{children:n("NFT_collection_id")}),(0,r.jsx)(j.RV,{children:(0,x.FN)((0,x.Tg)(t.collection.address,i,!0))})]})}),(0,r.jsx)(y.HC,{onClick:()=>s.copyToClipboard((0,x.Tg)(t.address,i,!0)),children:(0,r.jsxs)(y.me,{children:[(0,r.jsx)(h.__,{children:n("NFT_item_id")}),(0,r.jsx)(j.RV,{children:(0,x.FN)((0,x.Tg)(t.address,i,!0))})]})})]})};var E,C=n(30168),S=n(41235),k=n(73643),_=n(76978),A=n(1849),B=n(33455),R=n(97957),N=n(37460),L=n(60560),W=n(87294),I=n(65867),M=n(12116),Z=n(33945),F=n(3280),P=n(34692),V=n(11707),H=n(33375),O=n(55251),D=n(29205);const G=new _.n({asset:A.Ct,weiAmount:0}),Q={type:"nfr_transfer"},U=e=>{var t,n,s;let{recipient:i,onClose:a,nftItem:l,headerBlock:c,mainButton:p,multisigTTL:h}=e;const{standalone:x}=(0,d.bp)(),[v,j]=(0,o.useState)(!1),{t:g}=(0,u.$G)(),b=(0,L.IW)(),{data:E}=(0,M.ib)(Q),[C,_]=(0,o.useState)();(0,o.useEffect)((()=>{E&&_(E[0].type)}),[E]);const W=((e,t,n)=>{const r=(0,w.Mu)(),s=(0,w.vz)(),i=(0,H.Qb)(),a=(0,o.useMemo)((()=>{if(n){if("ton-multisig"===r.type)return{type:"multisig",ttlSeconds:300};if("external"===n)return M.SE;if("battery"===n)return M.lj;throw new Error("Unsupported sender type for nft transfer ".concat(n))}}),[n,r]),l=(0,M.qM)(a),d=(0,D.Q)(l),c=(0,Z.Hj)();return(0,S.useQuery)([R.S8.estimate,null===t||void 0===t?void 0:t.address,s,d],(async()=>{try{if("watch-only"===r.type)throw new Error("account not controllable");const n=new F.w(r.activeTonWallet.rawAddress),s=await l(),i=n.encodeNftTransfer({nftAddress:e.address,recipientAddress:t.address.address,forwardPayload:t.comment?(0,V.comment)(t.comment):null,responseAddress:"excessAddress"in s&&s.excessAddress?s.excessAddress:void 0});return await c.estimate(s,i)}catch(n){throw await i(n),n}}),{enabled:null!=t&&!!l&&void 0!==a})})(l,i,C),{mutateAsync:I,isLoading:U,error:q,reset:$}=((e,t,n,r)=>{const s=(0,w.Mu)(),i=(0,B.BJ)(),{mutateAsync:o}=(0,w.x_)(),a=(0,M.IS)(),l=(0,Z.Hj)(),d=(0,H.Qb)();return(0,S.useMutation)((async()=>{if("watch-only"===s.type)return console.error("Can't send a transfer using this account"),!1;if(!n)return!1;if(n.asset.id!==A.Ct.id)throw new Error("Unexpected fee asset ".concat(n.asset.symbol));try{let o;if("ton-multisig"===s.type){if(void 0===r.multisigTTL)throw new Error("TTL must be specified for multisig sending");o={type:"multisig",ttlSeconds:60*Number(r.multisigTTL)}}else if("external"===r.selectedSenderType)o=M.SE;else{if("battery"!==r.selectedSenderType)throw new Error("Unsupported sender type for nft transfer ".concat(r.selectedSenderType));o=M.lj}const d=await a(o),c=new F.w(s.activeTonWallet.rawAddress),u=new P.Z(F.w.nftTransferBase.toString()).plus(n.weiAmount),f=c.encodeNftTransfer({nftAddress:t.address,recipientAddress:e.address.address,forwardPayload:e.comment?(0,V.comment)(e.comment):null,nftTransferAmountWei:u,responseAddress:"excessAddress"in d&&d.excessAddress?d.excessAddress:void 0});await l.send(d,O.ds,f),i("send-nft")}catch(c){await d(c)}return await o(),!0}))})(i,l,null===(t=W.data)||void 0===t?void 0:t.extra,{multisigTTL:h,selectedSenderType:C}),J=null===(n=l.previews)||void 0===n?void 0:n.find((e=>"100x100"===e.resolution)),K=async()=>{if(U)return!1;try{$();const e=await I();return e&&(j(!0),setTimeout(a,2e3)),e}catch(e){return console.error(e),!1}};return(0,r.jsx)(m.vD.Provider,{value:{recipient:i,assetAmount:G,estimation:W,formState:{done:v,isLoading:U,error:q},onClose:()=>a(),onBack:()=>{},handleSubmit:K},children:(0,r.jsxs)(f.r4,{onSubmit:async e=>{e.stopPropagation(),e.preventDefault(),K()},standalone:x,children:[c,(0,r.jsxs)(N.kI,{children:[J?(0,r.jsx)(N.Ee,{src:J.url}):(0,r.jsx)(N.Ao,{}),(0,r.jsx)(N.DG,{children:null!==(s=l.dns)&&void 0!==s?s:l.metadata.name}),(0,r.jsx)(N.Dx,{children:g("txActions_signRaw_types_nftItemTransfer")})]}),(0,r.jsxs)(y.L8,{margin:!1,fullWidth:!0,children:[(0,r.jsx)(m.n_,{}),(0,r.jsx)(m.RB,{availableSendersChoices:E,selectedSenderType:C,onSenderTypeChange:_}),(0,r.jsx)(m.f1,{})]}),(0,r.jsx)(T,{nftItem:l}),(0,r.jsx)(k.Zv,{}),b&&h?(0,r.jsx)(z,{ttl:h}):null,p]})})},q=(0,I.zo)(W.G)(E||(E=(0,C.Z)(["\n    margin-bottom: 1rem;\n"]))),z=e=>{let{ttl:t}=e;const{data:n}=(0,L.F)(),{signerWallet:s}=(0,L.h3)();return n?(0,r.jsx)(q,{status:"progress",signedWallets:[],threshold:n.threshold,pendingWallets:n.signers,hostAddress:s.rawAddress,secondsLeft:60*Number(t)}):null};var $=n(3182);const J=e=>{let{nftItem:t,onClose:n}=e;const f=(0,c._)(),{t:x}=(0,u.$G)(),{standalone:v,extension:y}=(0,d.bp)(),j=(0,o.useRef)(null),g=(0,o.useRef)(null),w=(0,o.useRef)(null),[T,E]=(0,o.useState)(!0),[C,S]=(0,o.useState)(),k=(0,L.IW)(),{mutateAsync:_}=(0,p.gW)(),A=async e=>{E(!0),S(e),I("confirm")},B=(0,o.useCallback)((()=>{E(!1),S((e=>e?{...e,done:!1}:void 0)),I("recipient")}),[S]),[R,N]=(0,o.useState)(),[W,I]=(0,o.useState)(k?"multisig-settings":"recipient"),M=(0,o.useCallback)((async e=>{let{address:t}=e;const n={address:t},r=await _(n);A({address:{...n,blockchain:s.S.TON},toAccount:r,comment:"",done:!0})}),[A,_]),Z=async e=>{const t=(0,i.p)({url:e});if(null===t)return f.uiEvents.emit("copy",{method:"copy",params:x("Unexpected_QR_Code")});await M(t)},F={"multisig-settings":j,recipient:g,confirm:w}[W];return(0,r.jsx)(h.im,{standalone:v,extension:y,children:(0,r.jsx)(a.Z,{childFactory:(0,h.mH)(T),children:(0,r.jsx)(l.Z,{nodeRef:F,classNames:"right-to-left",addEndListener:e=>{setTimeout(e,h.x9)},children:e=>(0,r.jsxs)("div",{ref:F,children:["multisig-settings"===W&&(0,r.jsx)($.d,{onSubmit:e=>{E(!0),N(e.lifetime),I("recipient")},isAnimationProcess:"exiting"===e,Header:()=>(0,r.jsx)(h.io,{title:x("multisig_create_order_title"),onClose:n}),MainButton:h.c7}),"recipient"===W&&(0,r.jsx)(p.Aq,{data:C,setRecipient:A,onScan:Z,acceptBlockchains:[s.S.TON],MainButton:h.c7,HeaderBlock:()=>(0,r.jsx)(h.ap,{title:x("nft_transfer_title"),onClose:n,onBack:k?B:void 0})}),"confirm"===W&&(0,r.jsx)(U,{onClose:n,recipient:C,nftItem:t,mainButton:(0,r.jsx)(m.uq,{MainButton:h.y8}),headerBlock:(0,r.jsx)(b,{onBack:B,onClose:n}),multisigTTL:R})]})},W)})})},K=()=>{const e=(0,c._)(),[t,n]=(0,o.useState)(),s=(0,o.useCallback)((()=>{n(void 0)}),[n]);(0,o.useEffect)((()=>{const t=e=>{n(e.params)};return e.uiEvents.on("transferNft",t),()=>{e.uiEvents.off("transferNft",t)}}),[]);const i=(0,o.useCallback)((()=>{if(t)return(0,r.jsx)(J,{onClose:s,nftItem:t})}),[t,s]);return(0,r.jsx)(f.P_,{isOpen:!!t,handleClose:s,hideButton:!0,backShadow:!0,children:i})}},4959:(e,t,n)=>{n.d(t,{Z:()=>m});var r=n(9116),s=n(29580);var i=n(61174),o=n(72791),a=n(99172);function l(e,t){var n=Object.create(null);return e&&o.Children.map(e,(function(e){return e})).forEach((function(e){n[e.key]=function(e){return t&&(0,o.isValidElement)(e)?t(e):e}(e)})),n}function d(e,t,n){return null!=n[t]?n[t]:e.props[t]}function c(e,t,n){var r=l(e.children),s=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var r,s=Object.create(null),i=[];for(var o in e)o in t?i.length&&(s[o]=i,i=[]):i.push(o);var a={};for(var l in t){if(s[l])for(r=0;r<s[l].length;r++){var d=s[l][r];a[s[l][r]]=n(d)}a[l]=n(l)}for(r=0;r<i.length;r++)a[i[r]]=n(i[r]);return a}(t,r);return Object.keys(s).forEach((function(i){var a=s[i];if((0,o.isValidElement)(a)){var l=i in t,c=i in r,u=t[i],f=(0,o.isValidElement)(u)&&!u.props.in;!c||l&&!f?c||!l||f?c&&l&&(0,o.isValidElement)(u)&&(s[i]=(0,o.cloneElement)(a,{onExited:n.bind(null,a),in:u.props.in,exit:d(a,"exit",e),enter:d(a,"enter",e)})):s[i]=(0,o.cloneElement)(a,{in:!1}):s[i]=(0,o.cloneElement)(a,{onExited:n.bind(null,a),in:!0,exit:d(a,"exit",e),enter:d(a,"enter",e)})}})),s}var u=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},f=function(e){function t(t,n){var r,s=(r=e.call(this,t,n)||this).handleExited.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r));return r.state={contextValue:{isMounting:!0},handleExited:s,firstRender:!0},r}(0,i.Z)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(e,t){var n,r,s=t.children,i=t.handleExited;return{children:t.firstRender?(n=e,r=i,l(n.children,(function(e){return(0,o.cloneElement)(e,{onExited:r.bind(null,e),in:!0,appear:d(e,"appear",n),enter:d(e,"enter",n),exit:d(e,"exit",n)})}))):c(e,s,i),firstRender:!1}},n.handleExited=function(e,t){var n=l(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=(0,s.Z)({},t.children);return delete n[e.key],{children:n}})))},n.render=function(){var e=this.props,t=e.component,n=e.childFactory,s=(0,r.Z)(e,["component","childFactory"]),i=this.state.contextValue,l=u(this.state.children).map(n);return delete s.appear,delete s.enter,delete s.exit,null===t?o.createElement(a.Z.Provider,{value:i},l):o.createElement(a.Z.Provider,{value:i},o.createElement(t,s,l))},t}(o.Component);f.propTypes={},f.defaultProps={component:"div",childFactory:function(e){return e}};const m=f}}]);
//# sourceMappingURL=33.eb7343a5.chunk.js.map