"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[823],{94221:(e,t,n)=>{n.d(t,{Jh:()=>F,Tt:()=>E});var s,a,r,o,i=n(30168),d=n(80184),l=n(72791),c=n(57689),u=n(11087),m=n(65867),h=n(23098),x=n(61945),p=n(29305),j=n(14322),g=n(49373),f=n(26503),v=n(89242),y=n(47712),w=n(68827),b=n(2346),A=n(56093),S=n(56445),k=n(91153);const T=e=>{let{items:t,kind:n}=e;return(0,d.jsx)(f.L8,{margin:!1,children:t.filter((e=>!e.disabled)).map((e=>(0,d.jsx)(A.H,{item:e,kind:n},e.title)))})},P=m.ZP.div(s||(s=(0,i.Z)(["\n    display: flex;\n    flex-direction: column;\n    gap: 16px;\n"]))),C=e=>{let{item:t,kind:n,handleClose:s}=e;const a=(0,c.s0)(),r=(0,h._)(),{data:o}=(0,j.Nq)(),{t:i}=(0,x.$G)(),l=(0,k.TB)();return(0,d.jsxs)(P,{children:[(0,d.jsx)(v.JE,{children:(0,d.jsx)(v.O$,{children:(0,d.jsxs)(v.hy,{children:[(0,d.jsx)(w.$d,{country:o,onClick:()=>a(p.FR.settings+p.aF.country)}),(0,d.jsx)(y.H3,{children:t.title}),(0,d.jsx)(v.Ho,{handleClose:s})]})})}),(0,d.jsx)(T,{items:t.items,kind:n}),(0,d.jsx)(_,{children:(0,d.jsx)(N,{onClick:()=>l.exchangePostUrl&&r.openPage(l.exchangePostUrl),children:i("buy"===n?"exchange_modal_other_ways_to_buy":"exchange_other_ways")})})]})},_=m.ZP.div(a||(a=(0,i.Z)(["\n    text-align: center;\n\n    ","\n"])),(e=>"full-width"===e.theme.displayType&&(0,m.iv)(r||(r=(0,i.Z)(["\n            padding-bottom: 1rem;\n        "]))))),N=(0,m.ZP)(y.fA)(o||(o=(0,i.Z)(["\n    cursor: pointer;\n    padding: 7.5px 1rem 8.5px;\n    background-color: ",";\n    transition: background-color 0.1s ease;\n    border-radius: ",";\n    display: inline-block;\n\n    &:hover {\n        background-color: ",";\n    }\n"])),(e=>e.theme.backgroundContent),(e=>e.theme.cornerMedium),(e=>e.theme.backgroundHighlighted)),E=e=>{let{buy:t,open:n,handleClose:s}=e;const a=(0,l.useCallback)((()=>{if(n&&t)return(0,d.jsx)(C,{item:t,kind:"buy",handleClose:s})}),[n,t]);return(0,d.jsx)(v.P_,{isOpen:n&&null!=t,handleClose:s,hideButton:!0,children:a})},F=()=>{const{data:e}=(0,g.MF)(),t=(0,c.TH)(),[n,s]=(0,u.lr)(),a=(0,l.useMemo)((()=>"open"===new URLSearchParams(n).get("buy")),[n,t]),r=(0,l.useCallback)((()=>{n.has("buy")?n.delete("buy"):n.append("buy","open"),s(n,{replace:!0})}),[n,s]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(b.a,{icon:(0,d.jsx)(S.Vw,{}),title:"wallet_buy",action:r}),(0,d.jsx)(E,{buy:e,open:a,handleClose:r})]})}},56445:(e,t,n)=>{n.d(t,{Iy:()=>o,Vw:()=>a,jE:()=>r});var s=n(80184);const a=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",children:(0,s.jsx)("path",{d:"M14 21.5V14M14 14V6.5M14 14H21.5M14 14H6.5",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}),r=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",children:(0,s.jsx)("path",{d:"M14 6.5V21.5M14 6.5L7.5 13M14 6.5L20.5 13",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}),o=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",children:(0,s.jsx)("path",{d:"M14 21.5V6.5M14 21.5L7.5 15M14 21.5L20.5 15",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})},90648:(e,t,n)=>{n.d(t,{f:()=>i});var s=n(80184),a=n(23098),r=n(2346),o=n(56445);const i=e=>{let{chain:t,jetton:n}=e;const i=(0,a._)();return(0,s.jsx)(r.a,{icon:(0,s.jsx)(o.Iy,{}),title:"wallet_receive",action:()=>i.uiEvents.emit("receive",{method:"receive",params:{chain:t,jetton:n}})})}},83627:(e,t,n)=>{n.d(t,{Q:()=>m});var s,a=n(30168),r=n(80184),o=n(2346),i=n(5784),d=n(35976),l=n(65867),c=n(53006);const u=(0,l.zo)(i.Td)(s||(s=(0,a.Z)(["\n    height: 24px;\n    width: 24px;\n    color: ",";\n"])),(e=>e.theme.iconPrimary)),m=e=>{let{fromAsset:t}=e;const[n,s]=(0,d.J)(),[a,i]=(0,c.g7)();return(0,r.jsx)(o.a,{icon:(0,r.jsx)(u,{}),title:"swap_title",action:()=>{t&&i(t),s(!0)}})}},72884:(e,t,n)=>{n.d(t,{P:()=>m});var s=n(80184),a=n(1849),r=n(91153),o=n(38236),i=n(2346),d=n(94221),l=n(90648),c=n(83627),u=n(83273);const m=()=>{const e=(0,r.TH)(),t=(0,r.i7)()===u.Zc.TESTNET;return(0,s.jsxs)(i.G,{children:[!t&&(0,s.jsx)(d.Jh,{}),!e&&(0,s.jsx)(o.Q,{asset:"TON"}),(0,s.jsx)(l.f,{}),!t&&!e&&(0,s.jsx)(c.Q,{fromAsset:a.Ct})]})}},38236:(e,t,n)=>{n.d(t,{Q:()=>d});var s=n(80184),a=n(23098),r=n(2346),o=n(56445),i=n(14182);const d=e=>{let{asset:t}=e;const n=(0,a._)();return(0,s.jsx)(r.a,{icon:(0,s.jsx)(o.jE,{}),title:"wallet_send",action:()=>n.uiEvents.emit("transfer",{method:"transfer",id:Date.now(),params:{jetton:t,chain:i.S.TON,from:"TON"===t?"wallet":"token"}})})}},20823:(e,t,n)=>{n.r(t),n.d(t,{default:()=>X});var s=n(80184),a=n(72791),r=n(57689),o=n(29305),i=n(41235),d=n(11707),l=n(48544),c=n(24539),u=n(93853),m=n(99326),h=n(29857),x=n(3735),p=n(97541),j=n(2346),g=n(90648),f=n(83627),v=n(46574),y=n(38236),w=n(87594),b=n(61819),A=n(71757),S=n(97957),k=n(7393),T=n(57443),P=n(20504),C=n(91153);const _=e=>{let{balance:t,innerRef:n}=e;const a=(0,C.jE)(),{standalone:r}=(0,w.bp)(),o=(0,C.rT)(),{isFetched:d,hasNextPage:l,data:u,isFetchingNextPage:m,fetchNextPage:h}=(0,i.useInfiniteQuery)({queryKey:[t.walletAddress.address,S.S8.activity,S.kg.history],queryFn:e=>{let{pageParam:n}=e;return new c.HOX(a.tonApiV2).getAccountJettonHistoryByID({accountId:o.rawAddress,jettonId:t.jetton.address,limit:20,beforeLt:n})},getNextPageParam:e=>e.nextFrom>0?e.nextFrom:void 0});return(0,A.N)(l,m,h,r,n),(0,s.jsx)(p.b,{isFetched:d,isFetchingNextPage:m,tonEvents:u})},N=e=>{let{info:t,balance:n}=e;const[r,o]=(0,a.useMemo)((()=>[(0,u.og)(n.balance,t.metadata.decimals),d.Address.parse(n.jetton.address).toString()]),[t,n]),{data:i}=(0,T.UJ)(o),l=(0,b.PL)(r,t.metadata.decimals),{fiatAmount:c}=(0,T.to)(i,r),{description:m,image:h}=t.metadata;return(0,s.jsx)(v.f,{amount:l,symbol:t.metadata.symbol,price:c,description:m,image:h})},E=e=>{let{jettonAddress:t}=e;const{data:n}=(0,k.up)(t),{data:r}=(0,k.he)(t),o=(0,C.TH)(),{data:i}=(0,P.Iy)(),c=d.Address.parse(t).toRawString(),u=o||null===i||void 0===i?void 0:i.find((e=>(0,l.J)(e.address)===c)),p=(0,a.useRef)(null);return n&&r&&i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.bU,{title:n.metadata.name}),(0,s.jsxs)(m.HV,{ref:p,children:[(0,s.jsx)(N,{balance:r,info:n}),(0,s.jsxs)(j.G,{children:[!o&&(0,s.jsx)(y.Q,{asset:n.metadata.address}),(0,s.jsx)(g.f,{jetton:n.metadata.address}),u&&(0,s.jsx)(f.Q,{fromAsset:u})]}),(0,s.jsx)(_,{balance:r,innerRef:p})]})]}):(0,s.jsx)(h.vW,{})};var F=n(14182),O=n(72884),M=n(61945);const U=["TonTransfer","DepositStake","WithdrawStake","WithdrawStakeRequest","SmartContractExec","DomainRenew","AuctionBid"],Z=e=>{return!!U.includes(e.type)||("JettonSwap"===e.type?null!=(null===(t=e.jettonSwap)||void 0===t?void 0:t.tonIn)||null!=(null===(n=e.jettonSwap)||void 0===n?void 0:n.tonOut):!("ContractDeploy"!==e.type||null===(s=e.contractDeploy)||void 0===s||null===(s=s.interfaces)||void 0===s||!s.includes("wallet")));var t,n,s},L=e=>{let{info:{balance:t}}=e;const{t:n}=(0,M.$G)(),r=(0,a.useMemo)((()=>(0,u.og)(t)),[t]),o=(0,b.PL)(r),{data:i}=(0,T.UJ)(F.C.TON),{fiatAmount:d}=(0,T.to)(i,r);return(0,s.jsx)(v.f,{amount:o,symbol:"TON",price:d,description:n("Ton_page_description"),image:"https://wallet.tonkeeper.com/img/toncoin.svg"})},R=()=>{const{t:e}=(0,M.$G)(),t=(0,a.useRef)(null),{data:n}=(0,C.IR)(),r=(0,C.jE)(),{standalone:o}=(0,w.bp)(),d=(0,C.rT)(),{fetchNextPage:l,hasNextPage:u,isFetchingNextPage:j,data:g,isFetched:f}=(0,i.useInfiniteQuery)({queryKey:[d.rawAddress,S.S8.activity,"ton"],queryFn:e=>{let{pageParam:t}=e;return new c.HOX(r.tonApiV2).getAccountEvents({accountId:d.rawAddress,limit:20,beforeLt:t,subjectOnly:!0})},getNextPageParam:e=>e.nextFrom>0?e.nextFrom:void 0});(0,A.N)(u,j,l,o,t);const v=(0,a.useMemo)((()=>g?(e=>({pages:e.pages.reduce(((e,t)=>{const n=t.events.reduce(((e,t)=>(t.actions.some(Z)&&e.push(t),e)),[]);return n.length&&e.push({events:n,nextFrom:0}),e}),[]),pageParams:[]}))(g):void 0),[g]);return n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.bU,{title:e("Toncoin")}),(0,s.jsxs)(m.HV,{ref:t,children:[(0,s.jsx)(L,{info:n}),(0,s.jsx)(O.P,{chain:F.S.TON}),(0,s.jsx)(p.b,{isFetched:f,isFetchingNextPage:j,tonEvents:v})]})]}):(0,s.jsx)(h.vW,{activity:4})};var W,I,q=n(30168),H=n(65867),Q=n(47712),B=n(35300);const J=e=>{let{tronBalance:{token:t,weiAmount:n}}=e;const r=(0,a.useMemo)((()=>(0,u.og)(n,t.decimals)),[n,t]),o=(0,b.PL)(r,t.decimals),{data:i}=(0,T.UJ)(t.symbol),{fiatAmount:d}=(0,T.to)(i,r);return(0,s.jsx)(v.f,{amount:o,symbol:t.symbol,price:d,image:t.image})},V=e=>{let{tron:t,innerRef:n}=e;return null},G=H.ZP.div(W||(W=(0,q.Z)(["\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    line-height: 22px;\n"]))),D=(0,H.ZP)(Q.pN)(I||(I=(0,q.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),K=e=>{let{tron:t}=e;const{address:n}=(0,r.UO)(),i=(0,r.s0)(),{data:d,isLoading:l,isError:c}=(0,B._G)(t,n);(0,a.useEffect)((()=>{c&&i(o.FR.home)}),[c]);const u=(0,a.useRef)(null);return l||!d?(0,s.jsx)(h.vW,{}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.bU,{title:(0,s.jsxs)(G,{children:[(0,s.jsx)("div",{children:d.token.name}),(0,s.jsx)(D,{children:"TRC20"})]})}),(0,s.jsxs)(m.HV,{ref:u,children:[(0,s.jsx)(J,{tronBalance:d}),(0,s.jsxs)(j.G,{children:[(0,s.jsx)(y.Q,{asset:"TON"}),(0,s.jsx)(g.f,{chain:F.S.TRON})]}),(0,s.jsx)(V,{tron:t,innerRef:u})]})]})},$=()=>{const e=(0,r.s0)(),{data:t,isLoading:n,isError:i}=(0,B.yw)();return(0,a.useEffect)((()=>{i&&e(o.FR.home)}),[i]),n||!t?(0,s.jsx)(h.vW,{}):(0,s.jsx)(r.Z5,{children:(0,s.jsx)(r.AW,{path:":address",element:(0,s.jsx)(K,{tron:t})})})},X=()=>{const e=(0,r.s0)(),{name:t}=(0,r.UO)();return(0,a.useEffect)((()=>{t||e(o.FR.home)}),[t]),t?"tron"===t?(0,s.jsx)($,{}):"ton"===t?(0,s.jsx)(R,{}):(0,s.jsx)(E,{jettonAddress:decodeURIComponent(t)}):(0,s.jsx)(s.Fragment,{})}},20504:(e,t,n)=>{n.d(t,{Iy:()=>S,L:()=>T,UE:()=>C,bB:()=>N,r7:()=>P});var s=n(41235),a=n(11707),r=n(86445),o=n(14182),i=n(76978),d=n(39079),l=n(48544),c=n(24539),u=n(93853),m=n(27127),h=n(34692),x=n(72791),p=n(87594),j=n(23098),g=n(72119),f=n(97957),v=n(60793),y=n(7393),w=n(57443),b=n(94216),A=n(91153);function S(){const{swapService:e}=(0,b.W)(),{data:t}=_();return(0,s.useQuery)({queryKey:[f.S8.swapAllAssets,t],queryFn:async()=>{try{const n=await e.swapAssets();return n.map((e=>{const t="ton"===e.address?"TON":a.Address.parse(e.address);return{id:(0,d.G)(o.S.TON,t),symbol:e.symbol,decimals:e.decimals,name:e.name,image:e.image,blockchain:o.S.TON,address:t}})).filter((e=>!(t||[]).some((t=>t.id===e.id)))).concat(t||[])}catch(n){return console.error(n),[]}},enabled:!!t})}const k=(0,g.cn)("");function T(){return(0,g.KO)(k)}const P=()=>{const[e]=T(),{data:t}=function(){const[e]=(0,v.Li)(),{data:t}=S(),{data:n}=(0,w.UJ)(o.C.TON),{fiat:r}=(0,p.bp)();return(0,s.useQuery)({queryKey:[f.S8.swapWalletAssets,t,e,n,r],queryFn:async()=>{if(!e||!t||!n)return[];const s=t.map((t=>{var s;if((0,l.kC)(t.address))return{assetAmount:new i.n({asset:t,weiAmount:e.ton.info.balance}),fiatAmount:(0,u.PE)(new h.Z(e.ton.info.balance)).multipliedBy(n.prices)};const o=e.ton.jettons.balances.find((e=>a.Address.parse(e.jetton.address).equals(t.address)));return{assetAmount:new i.n({asset:t,weiAmount:(null===o||void 0===o?void 0:o.balance)||0}),fiatAmount:(0,u.PE)(new h.Z((null===o||void 0===o?void 0:o.balance)||0),t.decimals).multipliedBy(new h.Z((null===o||void 0===o||null===(s=o.price)||void 0===s||null===(s=s.prices)||void 0===s?void 0:s[r])||0))}}));return s.sort(((e,t)=>e.fiatAmount.isZero()&&t.fiatAmount.isZero()?t.assetAmount.weiAmount.comparedTo(e.assetAmount.weiAmount):t.fiatAmount.comparedTo(e.fiatAmount))),s},enabled:!!e&&!!t&&!!n})}();return(0,x.useMemo)((()=>{if(t)return t.filter((t=>{var n;if(!e)return!0;if((0,m.Ig)(e))return a.Address.parse(e).equals(t.assetAmount.asset.address);const s=e.toUpperCase();return!!(t.assetAmount.asset.symbol.toUpperCase().includes(s)||null!==(n=t.assetAmount.asset.name)&&void 0!==n&&n.toUpperCase().includes(s))||void 0}))}),[e,t])},C=()=>{const[e]=T(),t=(0,m.Ig)(e),{fiat:n}=(0,p.bp)(),r=(0,A.jE)(),{data:l}=(0,y.NR)();return(0,s.useQuery)({queryKey:[f.S8.swapCustomToken,e,l,n],queryFn:async()=>{if(!t)return null;try{var s;const t=a.Address.parse(e),m=await new c.EkG(r.tonApiV2).getJettonInfo({accountId:t.toRawString()}),x={address:t,image:m.metadata.image,blockchain:o.S.TON,name:m.metadata.name,symbol:m.metadata.symbol,decimals:Number(m.metadata.decimals),id:(0,d.G)(o.S.TON,t)},p=null===l||void 0===l?void 0:l.balances.find((e=>a.Address.parse(e.jetton.address).equals(t)));return{assetAmount:new i.n({asset:x,weiAmount:(null===p||void 0===p?void 0:p.balance)||new h.Z(0)}),fiatAmount:(0,u.PE)(new h.Z((null===p||void 0===p?void 0:p.balance)||0),x.decimals).multipliedBy(new h.Z((null===p||void 0===p||null===(s=p.price)||void 0===s||null===(s=s.prices)||void 0===s?void 0:s[n])||0))}}catch(m){return console.error(m),null}},enabled:t&&!!l})},_=()=>{const e=(0,j._)();return(0,s.useQuery)([r.l.SWAP_CUSTOM_ASSETS],(async()=>{const t=await e.storage.get(r.l.SWAP_CUSTOM_ASSETS);return(null===t||void 0===t?void 0:t.map((e=>({...e,blockchain:e.blockchain,address:(0,l.Wx)(e.address),id:(0,d.G)(e.blockchain,e.address)}))))||[]}))},N=()=>{const e=(0,j._)(),t=(0,s.useQueryClient)();return(0,s.useMutation)((async n=>{const s=await e.storage.get(r.l.SWAP_CUSTOM_ASSETS)||[];await e.storage.set(r.l.SWAP_CUSTOM_ASSETS,[...s,{...n,address:(0,l.J)(n.address)}]),await t.invalidateQueries([r.l.SWAP_CUSTOM_ASSETS])}))}}}]);
//# sourceMappingURL=823.bcd018c0.chunk.js.map