"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[976],{9356:(t,e,r)=>{r.d(e,{A:()=>a});var s=r(11707);function a(t,e){if(t&&t===e)return!0;try{return!!e&&("string"===typeof t&&(t=s.Address.parse(t)),"string"===typeof e&&(e=s.Address.parse(e)),t.equals(e))}catch(r){return!1}}},53006:(t,e,r)=>{r.d(e,{DC:()=>A,Fu:()=>m,K4:()=>S,MT:()=>T,RM:()=>C,dN:()=>b,g7:()=>w,vB:()=>f,xP:()=>y,y:()=>Z});var s=r(1849),a=r(48544),n=r(34692),o=r(72119),i=r(41235),c=r(97957),u=r(60793),d=r(57443),l=r(94216),p=r(72791),h=r(9356);const y=(0,o.cn)(s.Ct),f=(0,o.cn)(s.FS),v=(0,o.cn)(new n.Z(1)),w=()=>{const[t,e]=(0,o.KO)(y),[r,s]=(0,o.KO)(f);return[t,(0,p.useCallback)((t=>{(0,h.A)(t.address,f.value.address)&&s(y.value),e(t)}),[e,s])]},b=()=>{const[t,e]=(0,o.KO)(f),[r,s]=(0,o.KO)(y);return[t,(0,p.useCallback)((t=>{(0,h.A)(t.address,y.value.address)&&s(f.value),e(t)}),[e,s])]},Z=()=>(0,o.KO)(v),m=()=>{const{data:t,isError:e}=E(),[r]=w(),a=(0,u.hh)(r);return(0,i.useQuery)({queryKey:[c.S8.swapMaxValue,t,r.id,null===a||void 0===a?void 0:a.toFixed(0)],queryFn:async()=>{if(e)return a;if(a&&t){if(r.id===s.Ct.id){const e=new n.Z(t.dedust.tonToJetton),r=new n.Z(t.stonfi.tonToJetton),s=a.minus(n.Z.max(e,r)).minus(1e6);return s.lt(0)?new n.Z(0):s}return a}},enabled:(!!t||e)&&void 0!==a})},E=()=>{const{swapService:t}=(0,l.W)();return(0,i.useQuery)({queryKey:[c.S8.swapGasConfig],queryFn:async()=>t.swapGas()})},g=(0,o.cn)(void 0),S=()=>(0,o.KO)(g),T=()=>{const[t]=w(),[e]=b(),[r]=S(),{data:s,isLoading:o}=(0,d.UJ)((0,a.J)(t.address)),{data:i,isLoading:c}=(0,d.UJ)((0,a.J)(e.address)),u=null===r||void 0===r?void 0:r.trade;if(!u||c||o)return;if(null===s||void 0===s||!s.prices||null===i||void 0===i||!i.prices)return null;const l=new n.Z(u.from.relativeAmount).multipliedBy(s.prices),p=new n.Z(u.to.relativeAmount).multipliedBy(i.prices);return l.isEqualTo(p)?new n.Z(0):l.minus(p).dividedBy(l)},A=t=>t?t.isGreaterThan(.05)?"high":t.isGreaterThan(.01)?"medium":"low":"unknown",C=()=>{const[t]=Z();return!t||t.isZero()}},35976:(t,e,r)=>{r.d(e,{J:()=>h});var s=r(72119),a=r(72791),n=r(94216),o=r(23098),i=r(53006),c=r(87594),u=r(48544);const d=(t,e,r,s)=>{const a=new URL("https://app.ston.fi/swap");return a.searchParams.append("ft",l(t)),a.searchParams.append("tt",l(e)),a.searchParams.append("referral_address",s||""),a.searchParams.append("utm_source","tokeeper-".concat(r)),a.searchParams.append("utm_medium","organic"),a.searchParams.append("utm_campaign","swap_button"),a.searchParams.append("utm_content","TODO"),a.toString()},l=t=>(0,u.kC)(t)?"ton":t.toString({urlSafe:!0}),p=(0,s.cn)(!1),h=()=>{const[t,e]=(0,s.KO)(p),{isSwapsEnabled:r}=(0,n.W)(),u=(0,o._)(),{tonendpoint:l,env:h}=(0,c.bp)();return[t,(0,a.useCallback)((t=>{if(t&&!r){const t=d(i.xP.value.address,i.vB.value.address,l.targetEnv,null===h||void 0===h?void 0:h.stonfiReferralAddress);u.openPage(t)}else e(t)}),[e,r,u,l.targetEnv,null===h||void 0===h?void 0:h.stonfiReferralAddress])]}},94216:(t,e,r)=>{r.d(e,{W:()=>_});var s=r(21902),a=r(86033),n=r(13092);let o;class i extends Error{constructor(t){super(t),this.name="CancelError"}get isCancelled(){return!0}}var c=new WeakMap,u=new WeakMap,d=new WeakMap,l=new WeakMap,p=new WeakMap,h=new WeakMap,y=new WeakMap;o=Symbol.toStringTag;class f{constructor(t){(0,s.Z)(this,c,{writable:!0,value:void 0}),(0,s.Z)(this,u,{writable:!0,value:void 0}),(0,s.Z)(this,d,{writable:!0,value:void 0}),(0,s.Z)(this,l,{writable:!0,value:void 0}),(0,s.Z)(this,p,{writable:!0,value:void 0}),(0,s.Z)(this,h,{writable:!0,value:void 0}),(0,s.Z)(this,y,{writable:!0,value:void 0}),(0,n.Z)(this,c,!1),(0,n.Z)(this,u,!1),(0,n.Z)(this,d,!1),(0,n.Z)(this,l,[]),(0,n.Z)(this,p,new Promise(((e,r)=>{(0,n.Z)(this,h,e),(0,n.Z)(this,y,r);const s=t=>{(0,a.Z)(this,c)||(0,a.Z)(this,u)||(0,a.Z)(this,d)||(0,a.Z)(this,l).push(t)};return Object.defineProperty(s,"isResolved",{get:()=>(0,a.Z)(this,c)}),Object.defineProperty(s,"isRejected",{get:()=>(0,a.Z)(this,u)}),Object.defineProperty(s,"isCancelled",{get:()=>(0,a.Z)(this,d)}),t((t=>{(0,a.Z)(this,c)||(0,a.Z)(this,u)||(0,a.Z)(this,d)||((0,n.Z)(this,c,!0),(0,a.Z)(this,h)&&(0,a.Z)(this,h).call(this,t))}),(t=>{(0,a.Z)(this,c)||(0,a.Z)(this,u)||(0,a.Z)(this,d)||((0,n.Z)(this,u,!0),(0,a.Z)(this,y)&&(0,a.Z)(this,y).call(this,t))}),s)})))}get[o](){return"Cancellable Promise"}then(t,e){return(0,a.Z)(this,p).then(t,e)}catch(t){return(0,a.Z)(this,p).catch(t)}finally(t){return(0,a.Z)(this,p).finally(t)}cancel(){if(!((0,a.Z)(this,c)||(0,a.Z)(this,u)||(0,a.Z)(this,d))){if((0,n.Z)(this,d,!0),(0,a.Z)(this,l).length)try{for(const t of(0,a.Z)(this,l))t()}catch(t){return void console.warn("Cancellation threw an error",t)}(0,a.Z)(this,l).length=0,(0,a.Z)(this,y)&&(0,a.Z)(this,y).call(this,new i("Request aborted"))}}get isCancelled(){return(0,a.Z)(this,d)}}const v={BASE:"",VERSION:"1.0.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0};var w=r(64572);class b extends Error{constructor(t,e,r){super(r),(0,w.Z)(this,"url",void 0),(0,w.Z)(this,"status",void 0),(0,w.Z)(this,"statusText",void 0),(0,w.Z)(this,"body",void 0),(0,w.Z)(this,"request",void 0),this.name="ApiError",this.url=e.url,this.status=e.status,this.statusText=e.statusText,this.body=e.body,this.request=t}}var Z=r(37388).Buffer;const m=t=>void 0!==t&&null!==t,E=t=>"string"===typeof t,g=t=>E(t)&&""!==t,S=t=>"object"===typeof t&&"string"===typeof t.type&&"function"===typeof t.stream&&"function"===typeof t.arrayBuffer&&"function"===typeof t.constructor&&"string"===typeof t.constructor.name&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag]),T=t=>t instanceof FormData,A=t=>{const e=[],r=(t,s)=>{m(s)&&(Array.isArray(s)?s.forEach((e=>{r(t,e)})):"object"===typeof s?Object.entries(s).forEach((e=>{let[s,a]=e;r("".concat(t,"[").concat(s,"]"),a)})):((t,r)=>{e.push("".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(String(r))))})(t,s))};return Object.entries(t).forEach((t=>{let[e,s]=t;r(e,s)})),e.length>0?"?".concat(e.join("&")):""},C=async(t,e)=>"function"===typeof e?e(t):e,O=async(t,e)=>{const[r,s,a,n]=await Promise.all([C(e,t.TOKEN),C(e,t.USERNAME),C(e,t.PASSWORD),C(e,t.HEADERS)]),o=Object.entries({Accept:"application/json",...n,...e.headers}).filter((t=>{let[e,r]=t;return m(r)})).reduce(((t,e)=>{let[r,s]=e;return{...t,[r]:String(s)}}),{});if(g(r)&&(o.Authorization="Bearer ".concat(r)),g(s)&&g(a)){const t=(t=>{try{return btoa(t)}catch(e){return Z.from(t).toString("base64")}})("".concat(s,":").concat(a));o.Authorization="Basic ".concat(t)}return void 0!==e.body&&(e.mediaType?o["Content-Type"]=e.mediaType:S(e.body)?o["Content-Type"]=e.body.type||"application/octet-stream":E(e.body)?o["Content-Type"]="text/plain":T(e.body)||(o["Content-Type"]="application/json")),new Headers(o)},R=(t,e)=>new f((async(r,s,a)=>{try{const s=((t,e)=>{const r=t.ENCODE_PATH||encodeURI,s=e.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,((t,s)=>{var a;return null!==(a=e.path)&&void 0!==a&&a.hasOwnProperty(s)?r(String(e.path[s])):t})),a="".concat(t.BASE).concat(s);return e.query?"".concat(a).concat(A(e.query)):a})(t,e),n=(t=>{if(t.formData){const e=new FormData,r=(t,r)=>{E(r)||S(r)?e.append(t,r):e.append(t,JSON.stringify(r))};return Object.entries(t.formData).filter((t=>{let[e,r]=t;return m(r)})).forEach((t=>{let[e,s]=t;Array.isArray(s)?s.forEach((t=>r(e,t))):r(e,s)})),e}})(e),o=(t=>{var e;if(void 0!==t.body)return null!==(e=t.mediaType)&&void 0!==e&&e.includes("/json")?JSON.stringify(t.body):E(t.body)||S(t.body)||T(t.body)?t.body:JSON.stringify(t.body)})(e),i=await O(t,e);if(!a.isCancelled){const c=await(async(t,e,r,s,a,n,o)=>{const i=new AbortController,c={headers:n,body:null!==s&&void 0!==s?s:a,method:e.method,signal:i.signal};return t.WITH_CREDENTIALS&&(c.credentials=t.CREDENTIALS),o((()=>i.abort())),await fetch(r,c)})(t,e,s,o,n,i,a),u=await(async t=>{if(204!==t.status)try{const e=t.headers.get("Content-Type");if(e)return["application/json","application/problem+json"].some((t=>e.toLowerCase().startsWith(t)))?await t.json():await t.text()}catch(e){console.error(e)}})(c),d=((t,e)=>{if(e){const r=t.headers.get(e);if(E(r))return r}})(c,e.responseHeader),l={url:s,ok:c.ok,status:c.status,statusText:c.statusText,body:null!==d&&void 0!==d?d:u};((t,e)=>{const r={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...t.errors}[e.status];if(r)throw new b(t,e,r);if(!e.ok){var s,a;const r=null!==(s=e.status)&&void 0!==s?s:"unknown",n=null!==(a=e.statusText)&&void 0!==a?a:"unknown",o=(()=>{try{return JSON.stringify(e.body,null,2)}catch(t){return}})();throw new b(t,e,"Generic Error: status: ".concat(r,"; status text: ").concat(n,"; body: ").concat(o))}})(e,l),r(l.body)}}catch(n){s(n)}}));class k{static calculateSwap(t,e,r,s){return R(v,{method:"GET",url:"/v2/swap/calculate",query:{fromAsset:t,toAsset:e,fromAmount:r,provider:s},errors:{500:"Default Response"}})}static encodeSwap(t){return R(v,{method:"POST",url:"/v2/swap/encode",body:t,mediaType:"application/json",errors:{500:"Default Response"}})}static swapGas(){return R(v,{method:"GET",url:"/v2/swap/gas",errors:{500:"Default Response"}})}static swapAssets(){return R(v,{method:"GET",url:"/v2/swap/assets",errors:{500:"Default Response"}})}}var P=r(91153);const _=()=>{const t=(0,P.TB)();return v.BASE=t.web_swaps_url,{swapService:k,referralAddress:t.web_swaps_referral_address,isSwapsEnabled:!!t.web_swaps_url}}}}]);
//# sourceMappingURL=976.943b5ef7.chunk.js.map