"use strict";(self.webpackChunk_tonkeeper_extension=self.webpackChunk_tonkeeper_extension||[]).push([[106],{38197:(e,n,t)=>{t.d(n,{G:()=>r});var s=t(80184);function r(e){return n=>{let{error:t}=n;return(0,s.jsxs)("div",{role:"alert",children:[(0,s.jsx)("p",{children:e}),(0,s.jsx)("p",{children:"Something went wrong:"}),(0,s.jsx)("pre",{style:{color:"red"},children:t.message})]})}}},54106:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Ls});var s=t(30168),r=t(80184),i=t(47712),a=t(72791),o=t(57689),l=t(65867),d=t(29305),c=t(41235),u=t(20727),p=t(11707),m=t(94216),h=t(34692),x=t(23098),g=t(86445);const v=1,f=.3,j=()=>{const e=(0,x._)();return(0,c.useQuery)([g.l.SWAP_OPTIONS],(async()=>{const n=await e.storage.get(g.l.SWAP_OPTIONS);return{slippagePercent:(null===n||void 0===n?void 0:n.slippagePercent)||v,maxPriceImpact:(null===n||void 0===n?void 0:n.maxPriceImpact)||f}}))};var w=t(91153),y=t(98609),b=t(22288);function A(){const{mutateAsync:e}=function(){const e=(0,w.rT)(),{swapService:n}=(0,m.W)(),t=(0,w.TB)(),{data:s}=j(),r=t.web_swaps_referral_address;return(0,c.useMutation)((t=>{if(!s)throw new Error("SwapOptions query was not resolved yet");return n.encodeSwap({swap:S(t),options:{senderAddress:e.rawAddress,slippage:new h.Z(s.slippagePercent).div(100).decimalPlaces(5).toString(),...r&&{referralAddress:p.Address.parse(r).toRawString()},...t.excessAddress&&{excessAddress:t.excessAddress}}})}))}(),{data:n}=(0,b.YY)(),{excessAccount:t}=(0,b.RU)(),{data:s}=(0,w.cr)();return(0,c.useMutation)((async r=>{const i=[e(r)],a=!s||s.batterySettings.enabledForSwaps;null!==n&&void 0!==n&&n.batteryUnitsBalance.gt(0)&&a&&i.push(e({...r,excessAddress:p.Address.parse(t).toRawString()}));const o=await Promise.all(i),l=o[0],d={valid_until:(Date.now()+6e5)/1e3,messages:[{address:p.Address.parse(l.to).toString({bounceable:!0}),amount:l.value,payload:l.body}]},c=o[1];return c&&(d.messagesVariants={[y.QU.BATTERY]:[{address:p.Address.parse(c.to).toString({bounceable:!0}),amount:c.value,payload:c.body}]}),d}))}const S=e=>"stonfi"===e.provider?{provider:"stonfi",stonfiTrade:e.trade.rawTrade}:"dedust"===e.provider?{provider:"dedust",dedustTrade:e.trade.rawTrade}:void(0,u.U)(e);var k=t(53006),C=t(35976),Z=t(5784),z=t(96238),_=t(88674),T=t(93853),O=t(61945),P=t(48544),E=t(76978),F=t(24539),M=t(1849),R=t(39079),N=t(14182),D=t(9356),B=t(97957),$=t(72119);const G=new Map,U=["stonfi","dedust"],I=(0,$.cn)([]);let K=0;function W(){const e=(0,w.jE)(),[n,t]=(0,$.KO)(I),[s]=(0,k.g7)(),[r]=(0,k.dN)(),[i]=(0,k.y)(),[o,l]=(0,k.K4)(),d=(0,k.RM)(),{swapService:u}=(0,m.W)(),p=(0,c.useQuery)({queryKey:[B.S8.swapCalculate,s.id,r.id,null===i||void 0===i?void 0:i.shiftedBy(s.decimals).toFixed(0)],queryFn:async n=>{let{signal:a}=n;t([]),l(void 0),K+=1;const o=K;if(d)return[];V(s),V(r);const c=(0,T.$O)(i,s.decimals);let p=[];return new Promise(((n,i)=>{let d=0;U.forEach((async m=>{try{const h=u.calculateSwap(L(s.address),L(r.address),c.toFixed(0),m);a&&(a.onabort=()=>h.cancel());const x=await h,g=await J(x,e,s,r);if(o!==K)return void i(new Error("Calculation cancelled"));const v=Y(g)[0];p=Y(p.concat(v)),p[0].trade&&l(p[0]),t((e=>Y([...e,v]))),d+=1,d===U.length&&n(p)}catch(h){if(o!==K)return void i(new Error("Calculation cancelled"));console.error(h);const e={provider:m,trade:null};p=Y(p.concat(e)),p[0].trade&&l(p[0]),t((n=>Y([...n,e]))),d+=1,d===U.length&&n(p)}}))}))},cacheTime:0});return(0,a.useMemo)((()=>({...p,fetchedSwaps:n})),[p,n])}const L=e=>(0,P.kC)(e)?"ton":e.toRawString(),q=e=>"ton"===e?"TON":p.Address.parse(e),Y=e=>e.slice().sort(((e,n)=>e.trade?n.trade?n.trade.to.weiAmount.comparedTo(e.trade.to.weiAmount):-1:1)),J=async(e,n,t,s)=>{const r=await Q(e.trades,n);if("dedust"===e.provider)return 0===e.trades.length?[{provider:"dedust",trade:null}]:e.trades.map((e=>({provider:"dedust",trade:{from:new E.n({asset:t,weiAmount:e.fromAmount}),to:new E.n({asset:s,weiAmount:e.toAmount}),path:e.path.map((e=>r.find((n=>(0,D.A)(n.address,q(e)))))),blockchainFee:new E.n({asset:M.Ct,weiAmount:e.blockchainFee}),rawTrade:e.dedustRawTrade}})));if("stonfi"===e.provider){const n=e.trades[0];return n?[{provider:"stonfi",trade:{from:new E.n({asset:t,weiAmount:n.fromAmount}),to:new E.n({asset:s,weiAmount:n.toAmount}),blockchainFee:new E.n({asset:M.Ct,weiAmount:n.blockchainFee}),rawTrade:n.stonfiRawTrade,path:n.path.map((e=>r.find((n=>(0,D.A)(n.address,q(e))))))}}]:[{provider:"stonfi",trade:null}]}return[]},Q=async(e,n)=>{const t=e.flatMap((e=>e.path.map(q)));return Promise.all(t.map((e=>H(n,e))))},V=e=>{G.has(e.address)||G.set(e.address,Promise.resolve(e))},H=async(e,n)=>{if((0,P.kC)(n))return M.Ct;if(G.has(n))return G.get(n);const t=new F.EkG(e.tonApiV2).getJettonInfo({accountId:n.toRawString()}).then((e=>({symbol:e.metadata.symbol,decimals:Number(e.metadata.decimals),name:e.metadata.name,blockchain:N.S.TON,address:n,id:(0,R.G)(N.S.TON,n),image:e.metadata.image})));return G.set(n,t),t};var X=t(88754);const ee=e=>{let{onClick:n,isEncodingProcess:t}=e;const{t:s}=(0,O.$G)(),[i]=(0,k.y)(),[a]=(0,k.g7)(),{data:o}=(0,k.Fu)(),{isFetching:l,data:d}=W(),[c]=(0,k.K4)(),u=(0,k.MT)(),{data:p}=j();if((0,k.RM)())return(0,r.jsx)(X.zx,{size:"medium",secondary:!0,disabled:!0,children:s("swap_enter_amount")});if(!l&&null!==d&&void 0!==d&&d.every((e=>!e.trade)))return(0,r.jsx)(X.zx,{size:"medium",disabled:!0,children:s("swap_trade_is_not_available")});if(l&&(null===c||void 0===c||!c.trade)||!o||void 0===u||!p)return(0,r.jsx)(X.zx,{size:"medium",secondary:!0,loading:!0,children:s("continue")});if(!c||!c.trade)return(0,r.jsx)(X.zx,{size:"medium",secondary:!0,disabled:!0,children:s("swap_trade_is_not_available")});if(null===i||void 0===i?void 0:i.gt((0,T.PE)(o,a.decimals)))return(0,r.jsx)(X.zx,{size:"medium",secondary:!0,disabled:!0,children:s("swap_not_enough_funds")});return(null===u||void 0===u?void 0:u.gt(p.maxPriceImpact))?(0,r.jsx)(X.zx,{size:"medium",secondary:!0,disabled:!0,children:s("swap_price_impact_too_high")}):(0,r.jsx)(X.zx,{size:"medium",primary:!0,onClick:n,loading:t,children:s("continue")})};var ne=t(89242),te=t(20504),se=t(90820);const re=(0,a.forwardRef)(((e,n)=>{let{className:t,isDisabled:s}=e;const{t:i}=(0,O.$G)(),[a,o]=(0,te.L)();return(0,r.jsx)(se.II,{id:"swap-search",value:a,onChange:e=>o(e),ref:n,disabled:s,label:i("swap_search"),clearButton:!0,className:t,size:"small"})}));var ie,ae,oe,le,de=t(61819),ce=t(87594);const ue=l.zo.div(ie||(ie=(0,s.Z)(["\n    display: flex;\n    flex-direction: column;\n    text-align: center;\n"]))),pe=(0,l.zo)(i.pN)(ae||(ae=(0,s.Z)(["\n    display: block;\n    margin-top: 4px;\n    color: ",";\n"])),(e=>e.theme.textSecondary)),me=l.zo.div(oe||(oe=(0,s.Z)(["\n    width: 100%;\n    display: flex;\n    gap: 8px;\n    margin-top: 24px;\n\n    > * {\n        flex: 1;\n    }\n"]))),he=(0,l.zo)(ne.P_)(le||(le=(0,s.Z)(["\n    ","\n"])),(e=>"full-width"===e.theme.displayType&&"max-width: 400px;")),xe=e=>{let{isOpen:n,onClose:t,tokenSymbol:s}=e;const{t:a}=(0,O.$G)();return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(he,{isOpen:n,handleClose:t,children:()=>(0,r.jsxs)(ue,{children:[(0,r.jsx)(i.fA,{children:a("swap_import_token_title").replace("%token%",s)}),(0,r.jsx)(pe,{children:a("swap_unknown_token_description")}),(0,r.jsxs)(me,{children:[(0,r.jsx)(X.zx,{primary:!0,onClick:()=>t(!1),children:a("cancel")}),(0,r.jsx)(X.zx,{secondary:!0,onClick:()=>t(!0),children:a("swap_import")})]})]})})})};var ge,ve,fe,je,we,ye,be,Ae,Se,ke,Ce=t(27127);const Ze=l.zo.div(ge||(ge=(0,s.Z)(["\n    overflow-y: auto;\n    width: calc(100% + 2rem);\n    margin: 0 -1rem;\n    height: calc(100% - 54px);\n\n    &::-webkit-scrollbar {\n        display: none;\n    }\n\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n"]))),ze=l.zo.div(ve||(ve=(0,s.Z)(["\n    width: 100%;\n    height: 1px;\n    background-color: ",";\n"])),(e=>e.theme.separatorCommon)),_e=e=>{let{walletSwapAssets:n,onSelect:t}=e;const[s,i]=(0,a.useState)(n.slice(0,25)),o=(0,a.useRef)(null);(0,a.useEffect)((()=>{i(n.slice(0,25))}),[n]);return(0,r.jsx)(Ze,{ref:o,onScroll:(0,Ce.P2)((()=>{if(null===o||void 0===o||!o.current)return;o.current.scrollHeight-o.current.clientHeight-o.current.scrollTop<300&&i((e=>n.slice(0,e.length+25)))}),100),children:n.length?s.map(((e,s)=>(0,r.jsxs)(a.Fragment,{children:[(0,r.jsx)(Be,{onClick:()=>t(e.assetAmount.asset),swapAsset:e}),s!==n.length-1&&(0,r.jsx)(ze,{})]},e.assetAmount.asset.id))):(0,r.jsx)(Oe,{onSelect:t})})},Te=l.zo.div(fe||(fe=(0,s.Z)(["\n    height: 100%;\n    width: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: ",";\n"])),(e=>e.theme.textSecondary)),Oe=e=>{let{onSelect:n}=e;const{t:t}=(0,O.$G)(),{data:s,isFetching:o}=(0,te.UE)(),[l,d]=(0,a.useState)(!1),{mutate:c}=(0,te.bB)();if(o)return(0,r.jsx)(Te,{children:(0,r.jsx)(Z.L4,{})});if(!s)return(0,r.jsx)(Te,{children:(0,r.jsx)(i.pN,{children:t("swap_tokens_not_found")})});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(xe,{isOpen:l,onClose:e=>{d(!1),e&&(c(s.assetAmount.asset),n(s.assetAmount.asset))},tokenSymbol:s.assetAmount.asset.symbol}),(0,r.jsx)(Be,{onClick:()=>d(!0),swapAsset:s})]})},Pe=l.zo.button(je||(je=(0,s.Z)(["\n    border: none;\n    width: 100%;\n    padding: 8px 1rem;\n    display: flex;\n    gap: 12px;\n    background-color: transparent;\n\n    transition: background-color 0.15s ease-in-out;\n    cursor: pointer;\n\n    &:hover,\n    &:focus {\n        background-color: ",";\n    }\n"])),(e=>e.theme.backgroundContent)),Ee=l.zo.img(we||(we=(0,s.Z)(["\n    height: 40px;\n    width: 40px;\n    border-radius: 100%;\n"]))),Fe=l.zo.div(ye||(ye=(0,s.Z)(["\n    display: flex;\n    flex-direction: column;\n    width: calc(100% - 52px);\n"]))),Me=l.zo.div(be||(be=(0,s.Z)(["\n    display: flex;\n    align-items: center;\n    gap: 4px;\n\n    > *:first-child {\n        display: block;\n        overflow: hidden;\n        text-overflow: ellipsis;\n    }\n\n    > "," {\n        color: ",";\n    }\n\n    > *:nth-child(3) {\n        margin-left: auto;\n    }\n"])),i.fA,(e=>e.theme.textPrimary)),Re=l.zo.div(Ae||(Ae=(0,s.Z)(["\n    cursor: pointer;\n    &:hover {\n        > svg {\n            color: ",";\n        }\n    }\n"])),(e=>e.theme.iconSecondary)),Ne=(0,l.zo)(Me)(Se||(Se=(0,s.Z)(["\n    color: ",";\n\n    > *:nth-child(2) {\n        margin-left: auto;\n    }\n"])),(e=>e.theme.textSecondary)),De=(0,l.zo)(i.fA)(ke||(ke=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.isZero?e.theme.textTertiary:e.theme.textPrimary)),Be=e=>{let{swapAsset:n,onClick:t}=e;const s=n.assetAmount.relativeAmount.isZero(),{fiat:a}=(0,ce.bp)(),o=(0,x._)();return(0,r.jsxs)(Pe,{onClick:t,children:[(0,r.jsx)(Ee,{src:n.assetAmount.asset.image}),(0,r.jsxs)(Fe,{children:[(0,r.jsxs)(Me,{children:[(0,r.jsx)(i.fA,{children:n.assetAmount.asset.symbol}),(0,r.jsx)(Re,{onClick:e=>{let t;e.preventDefault(),e.stopPropagation(),t=(0,P.kC)(n.assetAmount.asset.address)?"https://tonviewer.com/price":"https://tonviewer.com/".concat(n.assetAmount.asset.address.toString({urlSafe:!0})),o.openPage(t)},children:(0,r.jsx)(Z.AT,{})}),(0,r.jsx)(De,{isZero:s,children:n.assetAmount.stringRelativeAmount})]}),(0,r.jsxs)(Ne,{children:[(0,r.jsx)(i.De,{children:n.assetAmount.asset.name}),!s&&(0,r.jsx)(i.De,{children:(0,de.hE)(a,n.fiatAmount)})]})]})]})};var $e,Ge,Ue,Ie,Ke,We,Le;const qe=(0,$.cn)(void 0),Ye=(0,l.zo)(ne.P_)($e||($e=(0,s.Z)(["\n    padding-bottom: 0;\n"]))),Je=()=>{const{t:e}=(0,O.$G)(),[n,t]=(0,$.KO)(qe),s=e=>{null===n||void 0===n||n.onClose(e),t(void 0)};return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(Ye,{isOpen:!!n,handleClose:()=>s(void 0),title:e("swap_tokens"),footer:(0,r.jsx)("div",{}),children:()=>(0,r.jsx)(en,{onSelect:s})})})},Qe=(0,l.zo)(re)(Ge||(Ge=(0,s.Z)(["\n    margin-bottom: 1rem;\n"]))),Ve=l.zo.div(Ue||(Ue=(0,s.Z)(["\n    ","\n"])),(e=>"full-width"===e.theme.displayType?(0,l.iv)(Ie||(Ie=(0,s.Z)(["\n                  height: 580px;\n              "]))):(0,l.iv)(Ke||(Ke=(0,s.Z)(["\n                  height: calc(var(--app-height) - 6rem);\n              "]))))),He=l.zo.div(We||(We=(0,s.Z)(["\n    width: calc(100% + 2rem);\n    margin: 0 -1rem;\n    height: 1px;\n    background-color: ",";\n"])),(e=>e.theme.separatorCommon)),Xe=l.zo.div(Le||(Le=(0,s.Z)(["\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    height: 300px;\n"]))),en=e=>{let{onSelect:n}=e;const t=(0,te.r7)(),s=(0,a.useRef)(),[i,o]=(0,te.L)();return(0,a.useEffect)((()=>(setTimeout((()=>{var e;return null===s||void 0===s||null===(e=s.current)||void 0===e?void 0:e.focus()}),100),()=>o(""))),[]),(0,r.jsxs)(Ve,{children:[(0,r.jsx)(Qe,{ref:s,isDisabled:!t}),(0,r.jsx)(He,{}),t?(0,r.jsx)(_e,{onSelect:n,walletSwapAssets:t}):(0,r.jsx)(Xe,{children:(0,r.jsx)(Z.L4,{})})]})};var nn,tn,sn;const rn=(0,l.zo)(i.fA)(nn||(nn=(0,s.Z)(["\n    display: block;\n    max-width: 80px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    flex-shrink: 0;\n    color: ",";\n\n    transition: color 0.15s ease-in-out;\n"])),(e=>e.theme.textPrimary)),an=l.zo.button(tn||(tn=(0,s.Z)(["\n    border: none;\n    display: flex;\n    align-items: center;\n    background: none;\n    padding: 0;\n    cursor: pointer;\n    gap: 6px;\n    height: 36px;\n    width: fit-content;\n\n    &:hover {\n        > "," {\n            color: ",";\n        }\n    }\n"])),rn,(e=>e.theme.textSecondary)),on=l.zo.img(sn||(sn=(0,s.Z)(["\n    height: 24px;\n    width: 24px;\n    border-radius: 100%;\n    flex-shrink: 0;\n"]))),ln=e=>{let{token:n,onTokenChange:t,className:s}=e;const i=(e=>{const[n,t]=(0,$.KO)(qe);return(0,a.useCallback)((()=>t((()=>({onClose:e})))),[t,e])})((0,a.useCallback)((e=>e&&t(e)),[t]));return(0,r.jsxs)(an,{className:s,onClick:i,children:[(0,r.jsx)(on,{src:n.image}),(0,r.jsx)(rn,{children:n.symbol}),(0,r.jsx)(Z.UR,{})]})};var dn,cn=t(27494),un=t(12850),pn=t(144);const mn=l.zo.input(dn||(dn=(0,s.Z)(["\n    border: none;\n    background: none;\n    text-align: right;\n    outline: none;\n    width: 30px;\n    color: ",";\n    font-family: inherit;\n\n    ","\n\n    &::placeholder {\n        color: ",";\n    }\n"])),(e=>e.isErrored?e.theme.accentRed:e.theme.textPrimary),i.Dv,(e=>e.theme.textTertiary));var hn,xn=t(57443),gn=t(46320);const vn=(0,l.zo)(i.De)(hn||(hn=(0,s.Z)(["\n    color: ",";\n    cursor: default;\n"])),(e=>e.theme.textSecondary)),fn=e=>{let{amount:n,asset:t}=e;const{fiat:s}=(0,ce.bp)(),{data:i,isLoading:a}=(0,xn.UJ)((0,P.J)(t.address));if(!n)return(0,r.jsx)("div",{});if(!a&&(null===i||void 0===i||!i.prices))return(0,r.jsx)("div",{});if(a)return(0,r.jsx)(gn.Od,{width:"80px",height:"12px",margin:"2px 0"});const o=(0,de.hE)(s,new h.Z(i.prices).multipliedBy(n));return(0,r.jsxs)(vn,{children:["\u2248\xa0",o]})};var jn,wn,yn,bn=t(60793);const An=(0,l.zo)(i.De)(jn||(jn=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),Sn=l.zo.div(wn||(wn=(0,s.Z)(["\n    display: flex;\n    height: 16px;\n    align-items: center;\n"]))),kn=l.zo.button(yn||(yn=(0,s.Z)(["\n    border: none;\n    background: none;\n    color: ",";\n    height: fit-content;\n    margin-left: 0.5rem;\n\n    > * {\n        display: block;\n        height: fit-content;\n    }\n\n    &:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n    }\n"])),(e=>e.theme.accentBlue)),Cn=()=>{const[e,n]=(0,k.y)(),[t]=(0,k.g7)(),{data:s}=(0,k.Fu)();return(0,r.jsx)(zn,{balance:s,decimals:t.decimals,onMax:()=>n((0,T.PE)(s,t.decimals))})},Zn=()=>{const[e]=(0,k.dN)(),n=(0,bn.hh)({address:e.address,blockchain:N.S.TON});return(0,r.jsx)(zn,{balance:n,decimals:e.decimals})},zn=e=>{let{balance:n,decimals:t=0,onMax:s}=e;const{t:a}=(0,O.$G)(),o=(0,de.rs)();return(0,r.jsxs)(Sn,{children:[(0,r.jsxs)(An,{children:[a("swap_balance"),":\xa0"]}),n?(0,r.jsx)(An,{children:o(n,t)}):(0,r.jsx)(gn.Od,{width:"80px",height:"12px",margin:"2px 0"}),s&&(0,r.jsx)(kn,{disabled:!n||n.isZero(),onClick:s,children:(0,r.jsx)(i.T3,{children:a("swap_max")})})]})};var _n,Tn,On,Pn,En,Fn;const Mn=l.zo.div(_n||(_n=(0,s.Z)(["\n    position: relative;\n    background: ",";\n    border-radius: ",";\n    padding: 6px 12px;\n"])),(e=>e.theme.backgroundContent),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall)),Rn=l.zo.div(Tn||(Tn=(0,s.Z)(["\n    color: ",";\n    gap: 8px;\n    display: flex;\n\n    padding: 4px 0;\n\n    > *:first-child {\n        margin-right: auto;\n    }\n\n    > * {\n        cursor: default;\n    }\n"])),(e=>e.theme.textSecondary)),Nn=l.zo.div(On||(On=(0,s.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 6px 0;\n"]))),Dn=l.zo.div(Pn||(Pn=(0,s.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 4px 0;\n    align-items: center;\n    height: 16px;\n\n    > * {\n        margin-left: auto;\n    }\n"]))),Bn=(0,l.zo)(ln)(En||(En=(0,s.Z)(["\n    flex-shrink: 0;\n"]))),$n=(0,l.zo)((e=>{let{value:n,onChange:t,decimals:s,className:i,isErrored:o}=e;const[l,d]=(0,a.useState)("");(0,a.useEffect)((()=>{if(n){if(!l.endsWith((0,cn.Yz)()))try{new h.Z((0,pn.rf)(l).replace((0,cn.Yz)(),".")).eq(n)||d((0,pn.jM)(n))}catch(e){}}else d("")}),[n]);const c=(0,cn.Yz)();return(0,r.jsx)(mn,{id:"swap-amount",value:l,onChange:e=>(e=>{let n=(0,un.VI)(e);if(!n)return d(""),void t(void 0);if((0,un.vu)(n,s)&&(0,pn.kE)(n)){if(!n.endsWith((0,cn.Yz)())){const e=new h.Z((0,pn.rf)(n).replace((0,cn.Yz)(),".")),s=new h.Z((0,pn.rf)(l).replace((0,cn.Yz)(),"."));e.eq(s)||(t(e),n=(0,pn.z6)(n))}d(n)}})(e.target.value),placeholder:"0".concat(c,"00"),className:i,isErrored:o,inputMode:"decimal"})}))(Fn||(Fn=(0,s.Z)(["\n    flex: 1;\n"]))),Gn=e=>{let{children:n}=e;const{t:t}=(0,O.$G)(),[s,a]=(0,k.y)(),[o,l]=(0,k.g7)(),{data:d}=(0,k.Fu)();return(0,r.jsxs)(Mn,{children:[(0,r.jsxs)(Rn,{children:[(0,r.jsx)(i.De,{children:t("swap_send")}),(0,r.jsx)(Cn,{})]}),(0,r.jsxs)(Nn,{children:[(0,r.jsx)(Bn,{token:o,onTokenChange:l}),(0,r.jsx)($n,{value:s,onChange:(0,Ce.Ds)(a),decimals:o.decimals,isErrored:!!d&&!!s&&s.gt((0,T.PE)(d,o.decimals))})]}),(0,r.jsx)(Dn,{children:(0,r.jsx)(fn,{amount:s,asset:o})}),n]})};var Un,In,Kn,Wn,Ln,qn,Yn;const Jn=l.zo.div(Un||(Un=(0,s.Z)(["\n    padding: 0 12px 12px;\n    background: ",";\n    border-radius: ",";\n    height: fit-content;\n"])),(e=>e.theme.backgroundContent),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall)),Qn=l.zo.div(In||(In=(0,s.Z)(["\n    color: ",";\n    padding: 10px 0;\n    display: flex;\n    align-items: center;\n    > * {\n        cursor: default;\n    }\n"])),(e=>e.theme.textSecondary)),Vn=()=>{const{t:e}=(0,O.$G)();return(0,k.RM)()?(0,r.jsx)("div",{}):(0,r.jsxs)(Jn,{children:[(0,r.jsx)(Qn,{children:(0,r.jsx)(i.De,{children:e("swap_provider")})}),(0,r.jsx)(rt,{provider:"stonfi"}),(0,r.jsx)(rt,{provider:"dedust"})]})},Hn=l.zo.div(Kn||(Kn=(0,s.Z)(["\n    height: 56px;\n    border-radius: ",";\n    border: 1px solid ",";\n    padding: 0 12px;\n    display: flex;\n    gap: 0.5rem;\n    align-items: center;\n    cursor: ",";\n\n    transition: border-color 0.15s ease-in-out;\n\n    &:not(:last-child) {\n        margin-bottom: 8px;\n    }\n"])),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall),(e=>e.isActive?e.theme.accentBlue:e.theme.separatorCommon),(e=>e.isDisabled?"not-allowed":"pointer")),Xn=l.zo.img(Wn||(Wn=(0,s.Z)(["\n    width: 24px;\n    height: 24px;\n    border-radius: 6px;\n"]))),et=l.zo.div(Ln||(Ln=(0,s.Z)(["\n    padding: 10px 0;\n    display: flex;\n    flex-direction: column;\n"]))),nt=l.zo.div(qn||(qn=(0,s.Z)(["\n    padding: 10px 0;\n    margin-left: auto;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n"]))),tt=(0,l.zo)(i.De)(Yn||(Yn=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),st={stonfi:{imageUrl:"https://wallet.tonkeeper.com/img/swap/stonfi.png",label:"STON.fi"},dedust:{imageUrl:"https://wallet.tonkeeper.com/img/swap/dedust.png",label:"DeDust"}},rt=e=>{let{provider:n}=e;const{t:t}=(0,O.$G)(),[s,a]=(0,k.K4)(),o=(null===s||void 0===s?void 0:s.provider)===n,{fetchedSwaps:l,isFetching:d}=W(),c=l.find((e=>e.provider===n)),u=null===c||void 0===c?void 0:c.trade,[p]=(0,k.dN)(),{data:m,isFetching:x}=(0,xn.UJ)((0,P.J)(p.address)),g=0===l.findIndex((e=>e.provider===n))&&!(null===c||void 0===c||!c.trade),v=st[n],{fiatAmount:f}=(0,xn.to)(m,(null===u||void 0===u?void 0:u.to.relativeAmount)||new h.Z(0));return(0,r.jsxs)(Hn,{isDisabled:!c||!u,isActive:o,onClick:()=>c&&u&&a(c),children:[(0,r.jsx)(Xn,{src:v.imageUrl}),(0,r.jsxs)(et,{children:[(0,r.jsx)(i.fA,{children:v.label}),g&&(0,r.jsx)(tt,{children:t("swap_best_price")})]}),(0,r.jsx)(nt,{children:d||u?(0,r.jsxs)(r.Fragment,{children:[u?(0,r.jsx)(i.fA,{children:u.to.stringAssetRelativeAmount}):(0,r.jsx)(gn.Od,{width:"60px",height:"14px",margin:"3px 0"}),m&&u?(0,r.jsxs)(tt,{children:["\u2248\xa0",f]}):x?(0,r.jsx)(gn.Od,{width:"60px",height:"12px",margin:"2px 0"}):(0,r.jsx)("div",{})]}):(0,r.jsx)(tt,{children:t("swap_trade_is_not_available")})})]})};var it,at,ot,lt,dt=t(98605);const ct=l.zo.div(it||(it=(0,s.Z)(["\n    transform: translateY(-100%);\n    visibility: hidden;\n    transition: transform ","ms ease-in-out,\n        visibility ","ms ease-in-out;\n"])),(e=>e.$transitionMS),(e=>e.$transitionMS)),ut=l.zo.div(at||(at=(0,s.Z)(["\n    display: grid;\n    grid-template-rows: ",";\n    overflow: ",";\n    transition: grid-template-rows ","ms ease-in-out;\n\n    "," {\n        ","\n    }\n"])),(e=>e.$isOpened?"1fr":"0fr"),(e=>e.$animationCompleted&&e.$isOpened?"visible":"hidden"),(e=>e.$transitionMS),ct,(e=>e.$isOpened&&(0,l.iv)(ot||(ot=(0,s.Z)(["\n                transform: translateY(0);\n                visibility: visible;\n            "]))))),pt=l.zo.div(lt||(lt=(0,s.Z)(["\n    min-height: 0;\n    min-width: 0;\n"]))),mt=e=>{let{children:n,isOpened:t,transitionMS:s=200}=e;const[i,o]=(0,a.useState)(!1),l=(0,a.useRef)();return(0,a.useEffect)((()=>{clearTimeout(l.current),t?o(!1):l.current=setTimeout((()=>o(!0)),200)}),[t]),(0,r.jsx)(ut,{$animationCompleted:i,$isOpened:t,$transitionMS:s,children:(0,r.jsx)(pt,{children:(0,r.jsx)(ct,{$transitionMS:s,children:n})})})};var ht,xt,gt,vt,ft,jt,wt,yt,bt,At,St,kt,Ct,Zt,zt;const _t=l.zo.div(ht||(ht=(0,s.Z)([""]))),Tt=l.zo.div(xt||(xt=(0,s.Z)(["\n    cursor: pointer;\n    padding: 4px 0;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    color: ",";\n\n    svg {\n        color: ",";\n    }\n"])),(e=>e.theme.textSecondary),(e=>e.theme.textSecondary)),Ot=l.zo.div(gt||(gt=(0,s.Z)(["\n    transform: translateY(-100%);\n    visibility: hidden;\n    transition: transform 0.2s ease-in-out, visibility 0.2s ease-in-out;\n"]))),Pt=(l.zo.div(vt||(vt=(0,s.Z)(["\n    display: grid;\n    grid-template-rows: ",";\n    overflow: ",";\n    transition: grid-template-rows 0.2s ease-in-out;\n\n    "," {\n        ","\n    }\n"])),(e=>e.isOpened?"1fr":"0fr"),(e=>e.animationCompleted&&e.isOpened?"visible":"hidden"),Ot,(e=>e.isOpened&&(0,l.iv)(ft||(ft=(0,s.Z)(["\n                transform: translateY(0);\n                visibility: visible;\n            "]))))),l.zo.div(jt||(jt=(0,s.Z)(["\n    min-height: 0;\n"]))),(0,l.zo)(_.h)(wt||(wt=(0,s.Z)(["\n    transform: ",";\n    transition: transform 0.2s ease-in-out;\n    border: none;\n"])),(e=>e.isOpened?"rotate(180deg)":"rotate(0deg)"))),Et=l.zo.div(yt||(yt=(0,s.Z)(["\n    position: relative;\n    display: flex;\n    padding: 4px 0;\n    gap: 6px;\n    align-items: center;\n\n    > * {\n        cursor: default;\n    }\n"]))),Ft=l.zo.div(bt||(bt=(0,s.Z)(["\n    pointer-events: none;\n    transform: translate3d(0, -10px, 0);\n    z-index: 100;\n    left: 0;\n    right: 0;\n    transition: all 0.15s ease-in-out;\n    opacity: 0;\n    position: absolute;\n    background-color: ",";\n    padding: 8px 12px;\n    ",";\n    ",";\n\n    ","\n"])),(e=>e.theme.backgroundContentTint),dt.G,i.C2,(e=>"top"===e.placement?(0,l.iv)(At||(At=(0,s.Z)(["\n                  transform: translate3d(0, 10px, 0);\n                  bottom: 30px;\n              "]))):(0,l.iv)(St||(St=(0,s.Z)(["\n                  transform: translate3d(0, -10px, 0);\n                  top: 30px;\n              "]))))),Mt=l.zo.div(kt||(kt=(0,s.Z)(["\n    cursor: pointer;\n\n    &:hover + "," {\n        opacity: 1;\n        transform: translate3d(0, 0, 0);\n    }\n"])),Ft),Rt=(0,l.zo)(i.De)(Ct||(Ct=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.theme.textSecondary)),Nt=(0,l.zo)(i.De)(Zt||(Zt=(0,s.Z)(["\n    margin-left: auto;\n"]))),Dt=()=>(0,r.jsx)(gn.Od,{width:"60px",height:"12px",margin:"2px 0"}),Bt=(0,l.zo)(i.De)(zt||(zt=(0,s.Z)(["\n    color: ",";\n"])),(e=>"low"===e.status?e.theme.accentGreen:"medium"===e.status||"unknown"===e.status?e.theme.accentOrange:e.theme.accentRed)),$t=()=>{const{t:e}=(0,O.$G)(),[n,t]=(0,a.useState)(!1),{isFetching:s}=W(),[o]=(0,k.K4)(),l=(0,k.MT)(),{data:d}=j(),c=(0,k.RM)(),u=null===o||void 0===o?void 0:o.trade;if(!s&&!u||c)return null;return(0,r.jsxs)(_t,{children:[(0,r.jsxs)(Tt,{onClick:()=>{t((e=>!e))},children:[(0,r.jsx)(i.De,{children:e("swap_tx_info")}),(0,r.jsx)(Pt,{transparent:!0,isOpened:n,children:(0,r.jsx)(Z.v4,{})})]}),(0,r.jsxs)(mt,{isOpened:n,children:[(0,r.jsxs)(Et,{children:[(0,r.jsx)(Rt,{children:e("swap_price_impact")}),(0,r.jsx)(Mt,{children:(0,r.jsx)(Z.uM,{})}),(0,r.jsx)(Ft,{placement:"top",children:e("swap_price_impact_tooltip")}),(0,r.jsx)(Nt,{children:void 0!==l&&u?(0,r.jsx)(Bt,{status:(0,k.DC)(l),children:l?(0,r.jsxs)(r.Fragment,{children:["\u2248\xa0","".concat(l.multipliedBy(100).decimalPlaces(2).toString().replace(".",(0,cn.Yz)()).replace("-","+"),"%")]}):e("swap_unknown_price_impact")}):(0,r.jsx)(Dt,{})})]}),(0,r.jsxs)(Et,{children:[(0,r.jsx)(Rt,{children:e("swap_minimum_received")}),(0,r.jsx)(Mt,{children:(0,r.jsx)(Z.uM,{})}),(0,r.jsx)(Ft,{placement:"top",children:e("swap_minimum_received_tooltip")}),(0,r.jsx)(Nt,{children:u&&d?(0,r.jsxs)(i.De,{children:["\u2248\xa0",new E.n({weiAmount:u.to.weiAmount.multipliedBy(100-d.slippagePercent).div(100),asset:u.to.asset}).stringAssetRelativeAmount]}):(0,r.jsx)(Dt,{})})]}),(0,r.jsxs)(Et,{children:[(0,r.jsx)(Rt,{children:e("swap_slippage")}),(0,r.jsx)(Mt,{children:(0,r.jsx)(Z.uM,{})}),(0,r.jsx)(Ft,{placement:"top",children:e("swap_slippage_tooltip")}),(0,r.jsx)(Nt,{children:u&&d?(0,r.jsxs)(i.De,{children:[d.slippagePercent,"%"]}):(0,r.jsx)(Dt,{})})]}),(0,r.jsxs)(Et,{children:[(0,r.jsx)(Rt,{children:e("swap_blockchain_fee")}),(0,r.jsx)(Mt,{children:(0,r.jsx)(Z.uM,{})}),(0,r.jsx)(Ft,{placement:"top",children:e("swap_blockchain_fee_tooltip")}),(0,r.jsx)(Nt,{children:u?(0,r.jsxs)(i.De,{children:["\u2248\xa0",u.blockchainFee.stringAssetRelativeAmount]}):(0,r.jsx)(Dt,{})})]}),(0,r.jsxs)(Et,{children:[(0,r.jsx)(Rt,{children:e("swap_route")}),(0,r.jsx)(Nt,{children:u?(0,r.jsx)(i.De,{children:u.path.map((e=>e.symbol)).join(" \u2192 ")}):(0,r.jsx)(Dt,{})})]})]})]})};var Gt,Ut;const It=(0,l.zo)(i.De)(Gt||(Gt=(0,s.Z)(["\n    display: flex;\n    align-items: center;\n    gap: 4px;\n    color: ",";\n    cursor: pointer;\n    transition: color 0.15s ease-in-out;\n\n    &:hover {\n        ",";\n    }\n"])),(e=>"medium"===e.impact?e.theme.accentOrange:"high"===e.impact?e.theme.accentRed:e.theme.textSecondary),(e=>"medium"!==e.impact&&"high"!==e.impact&&(0,l.iv)(Ut||(Ut=(0,s.Z)(["\n                color: ",";\n            "])),e.theme.textPrimary))),Kt=()=>(0,r.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.18144 1.65C4.63413 0.86592 4.86047 0.473881 5.11842 0.286474C5.64415 -0.0954914 6.35604 -0.0954914 6.88177 0.286474C7.13971 0.473881 7.36606 0.86592 7.81875 1.65L11.1096 7.35L11.1097 7.35001C11.5623 8.13408 11.7887 8.52612 11.822 8.84321C11.8899 9.48949 11.534 10.106 10.9403 10.3703C10.6491 10.5 10.1964 10.5 9.29099 10.5H2.7092C1.80382 10.5 1.35113 10.5 1.05986 10.3703C0.466204 10.106 0.110258 9.48949 0.178184 8.84321C0.211512 8.52612 0.437856 8.13408 0.890544 7.35L4.18144 1.65ZM5.1001 8.1C5.1001 7.60294 5.50304 7.2 6.0001 7.2C6.49715 7.2 6.9001 7.60294 6.9001 8.1C6.9001 8.59706 6.49715 9 6.0001 9C5.50304 9 5.1001 8.59706 5.1001 8.1ZM6.00002 2C5.53718 2 5.16822 2.38674 5.18997 2.84906L5.31946 5.60072C5.33656 5.96414 5.63619 6.25 6.00002 6.25C6.36384 6.25 6.66347 5.96414 6.68057 5.60072L6.81006 2.84906C6.83182 2.38674 6.46285 2 6.00002 2Z",fill:"currentColor"})}),Wt=()=>{const[e,n]=(0,a.useState)("from"),[t]=(0,k.K4)(),{isFetching:s}=W(),i=(0,k.MT)(),o=s&&!(null!==t&&void 0!==t&&t.trade)||void 0===i;if(!s&&!(null!==t&&void 0!==t&&t.trade))return null;if(o)return(0,r.jsx)(gn.Od,{width:"100px",height:"12px",margin:"2px 0"});const l=t.trade,d="from"===e?l.from:l.to,c="from"===e?l.to:l.from;if(d.relativeAmount.isZero())return null;const u=c.relativeAmount.div(d.relativeAmount),p=E.n.fromRelativeAmount({amount:u,asset:c.asset}),m=(0,k.DC)(i);return(0,r.jsxs)(It,{impact:m,onClick:()=>n((e=>"from"===e?"to":"from")),children:["1\xa0",d.asset.symbol,"\xa0\u2248\xa0",p.stringAssetRelativeAmount,("medium"===m||"high"===m)&&(0,r.jsx)(Kt,{})]})};var Lt,qt,Yt,Jt,Qt,Vt,Ht;const Xt=l.zo.div(Lt||(Lt=(0,s.Z)(["\n    background: ",";\n    border-radius: ",";\n    padding: 6px 12px;\n"])),(e=>e.theme.backgroundContent),(e=>"full-width"===e.theme.displayType?e.theme.corner2xSmall:e.theme.cornerSmall)),es=l.zo.div(qt||(qt=(0,s.Z)(["\n    color: ",";\n    gap: 8px;\n    display: flex;\n\n    padding: 4px 0;\n\n    > *:first-child {\n        margin-right: auto;\n    }\n\n    > * {\n        cursor: default;\n    }\n"])),(e=>e.theme.textSecondary)),ns=l.zo.div(Yt||(Yt=(0,s.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 6px 0;\n"]))),ts=l.zo.div(Jt||(Jt=(0,s.Z)(["\n    margin-left: auto;\n    overflow: auto;\n\n    cursor: default;\n\n    &::-webkit-scrollbar {\n        display: none;\n    }\n\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n"]))),ss=l.zo.div(Qt||(Qt=(0,s.Z)(["\n    display: flex;\n    gap: 8px;\n    padding: 4px 0;\n    align-items: center;\n    height: 16px;\n\n    > :last-child {\n        margin-left: auto;\n    }\n"]))),rs=(0,l.zo)(ln)(Vt||(Vt=(0,s.Z)(["\n    flex-shrink: 0;\n"]))),is=(0,l.zo)(i.J1)(Ht||(Ht=(0,s.Z)(["\n    color: ",";\n"])),(e=>e.theme.textTertiary)),as=()=>{var e;const{t:n}=(0,O.$G)(),[t,s]=(0,k.dN)(),{isFetching:a}=W(),[o]=(0,k.K4)();return(0,r.jsxs)(Xt,{children:[(0,r.jsxs)(es,{children:[(0,r.jsx)(i.De,{children:n("swap_receive")}),(0,r.jsx)(Zn,{})]}),(0,r.jsxs)(ns,{children:[(0,r.jsx)(rs,{token:t,onTokenChange:s}),(0,r.jsx)(ts,{children:null!==o&&void 0!==o&&o.trade||!a?null!==o&&void 0!==o&&o.trade?(0,r.jsx)(i.J1,{children:o.trade.to.stringRelativeAmount}):(0,r.jsx)(is,{children:"0"}):(0,r.jsx)(gn.Od,{width:"100px",height:"28px",margin:"4px 0"})})]}),(0,r.jsxs)(ss,{children:[(0,r.jsx)(Wt,{}),(0,r.jsx)(fn,{amount:null===o||void 0===o||null===(e=o.trade)||void 0===e?void 0:e.to.relativeAmount,asset:t})]}),(0,r.jsx)($t,{})]})};var os,ls;const ds=l.zo.div(os||(os=(0,s.Z)(["\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n"]))),cs=(0,l.zo)(_.h)(ls||(ls=(0,s.Z)(["\n    height: 32px;\n    width: 32px;\n    position: absolute;\n    right: calc(50% - 16px);\n    bottom: -20px;\n    border: none;\n\n    background-color: ",";\n\n    > svg {\n        transition: color 0.15s ease-in-out;\n    }\n\n    &:hover {\n        background-color: ",";\n        > svg {\n            color: ",";\n        }\n    }\n"])),(e=>e.theme.buttonTertiaryBackground),(e=>e.theme.buttonTertiaryBackgroundHighlighted),(e=>e.theme.iconPrimary)),us=e=>{let{className:n}=e;const t=(0,l.Fg)(),{isLoading:s,mutateAsync:i}=A(),[c,u]=(0,a.useState)(null),[p]=(0,k.K4)(),[m,h]=(0,k.g7)(),[x,g]=(0,k.dN)(),[v,f]=(0,k.y)(),j=(0,o.s0)(),[w,y]=(0,C.J)();return(0,r.jsxs)(ds,{className:n,children:[(0,r.jsx)(Gn,{children:(0,r.jsx)(cs,{"data-testid":"change-swap",onClick:()=>{h(x),g(m),null!==p&&void 0!==p&&p.trade&&f(p.trade.to.relativeAmount)},children:(0,r.jsx)(Z.Td,{})})}),(0,r.jsx)(as,{}),"compact"===t.displayType&&(0,r.jsx)(Vn,{}),(0,r.jsx)(ee,{onClick:async()=>{const e=await i(p);u(e)},isEncodingProcess:s||!!c}),(0,r.jsx)(z.o,{handleClose:e=>{u(null),e&&(j(d.FR.activity),y(!1))},params:c,waitInvalidation:!0}),(0,r.jsx)(Je,{})]})};var ps,ms,hs=t(59371),xs=t(38197);const gs=l.zo.label(ps||(ps=(0,s.Z)(["\n    cursor: pointer;\n    ",";\n    ",";\n    box-sizing: border-box;\n\n    text-align: center;\n\n    padding: 8px 12px;\n\n    background: ",";\n    border: 1px solid transparent;\n    transition: border-color 0.15s ease-in-out;\n"])),dt.G,i.C2,(e=>e.theme.fieldBackground)),vs=l.zo.input(ms||(ms=(0,s.Z)(["\n    display: none;\n\n    &:checked + "," {\n        border: 1px solid ",";\n    }\n"])),gs,(e=>e.theme.accentBlue)),fs=(0,a.forwardRef)(((e,n)=>{const t=(0,a.useId)(),s=e.id||t,{className:i,children:o,...l}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(vs,{type:"radio",ref:n,id:s,...l}),(0,r.jsx)(gs,{className:i,htmlFor:s,children:o})]})}));var js,ws,ys,bs,As;const Ss=e=>{let{isOpen:n,onClose:t}=e;const{t:s}=(0,O.$G)();return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(ne.P_,{isOpen:n,handleClose:t,title:s("swap_settings"),children:()=>(0,r.jsx)(Ps,{onClose:t})})})},ks=l.zo.div(js||(js=(0,s.Z)(["\n    padding-bottom: 10px;\n\n    > * {\n        display: block;\n        cursor: default;\n    }\n\n    > "," {\n        color: ",";\n    }\n"])),i.De,(e=>e.theme.textSecondary)),Cs=l.zo.div(ws||(ws=(0,s.Z)(["\n    display: flex;\n    gap: 0.5rem;\n    margin-bottom: 2rem;\n"]))),Zs=(0,l.zo)(fs)(ys||(ys=(0,s.Z)(["\n    height: 36px;\n    flex: 1;\n"]))),zs=l.zo.div(bs||(bs=(0,s.Z)(["\n    display: flex;\n    gap: 0.5rem;\n    > * {\n        flex: 1;\n    }\n"]))),_s=[.5,1,3,5],Ts=_s[1],Os=l.zo.div(As||(As=(0,s.Z)(["\n    height: 200px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n"]))),Ps=e=>{let{onClose:n}=e;const{t:t}=(0,O.$G)(),{data:s}=j(),{mutate:o}=(()=>{const e=(0,x._)(),n=(0,c.useQueryClient)();return(0,c.useMutation)((async t=>{const s=await e.storage.get(g.l.SWAP_OPTIONS);await e.storage.set(g.l.SWAP_OPTIONS,{...s,...t}),await n.invalidateQueries([g.l.SWAP_OPTIONS])}))})(),[l,d]=(0,a.useState)();if((0,a.useLayoutEffect)((()=>{null!==s&&void 0!==s&&s.slippagePercent&&(_s.includes(null===s||void 0===s?void 0:s.slippagePercent)?d(null===s||void 0===s?void 0:s.slippagePercent):(d(Ts),o({slippagePercent:Ts})))}),[null===s||void 0===s?void 0:s.slippagePercent]),!s)return(0,r.jsx)(Os,{children:(0,r.jsx)(Z.L4,{})});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(ks,{children:[(0,r.jsx)(i.fA,{children:t("swap_slippage")}),(0,r.jsx)(i.De,{children:t("swap_slippage_description")})]}),(0,r.jsx)(Cs,{children:_s.map((e=>(0,r.jsxs)(Zs,{name:"slippage-percent",value:e,checked:l===e,onChange:()=>d(e),children:[e,"%"]},e)))}),(0,r.jsxs)(zs,{children:[(0,r.jsx)(X.zx,{secondary:!0,onClick:n,children:t("cancel")}),(0,r.jsx)(X.zx,{primary:!0,disabled:l===s.slippagePercent,onClick:()=>{o({slippagePercent:l}),null===n||void 0===n||n()},children:t("save")})]})]})},Es=()=>{const[e,n]=(0,a.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_.S,{onClick:()=>n(!0),children:(0,r.jsx)(Z.bZ,{})}),(0,r.jsx)(Ss,{isOpen:e,onClose:()=>n(!1)})]})};let Fs=!1;const Ms=()=>{const{refetch:e,isFetching:n}=W(),[t,s]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{if(Fs=!1,!n){s(!0);const n=setTimeout((()=>{Fs||(e(),Fs=!0)}),15e3);return()=>clearTimeout(n)}s(!1)}),[n]),(0,r.jsx)(_.S,{onClick:()=>e(),children:t?(0,r.jsx)(Z.ut,{}):(0,r.jsx)(Z.Du,{})})};var Rs,Ns,Ds,Bs;const $s=l.zo.div(Rs||(Rs=(0,s.Z)(["\n    position: relative;\n"]))),Gs=l.zo.div(Ns||(Ns=(0,s.Z)(["\n    display: flex;\n"]))),Us=(0,l.zo)(i.fA)(Ds||(Ds=(0,s.Z)(["\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 5rem;\n    right: 2rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: transparent;\n"]))),Is=()=>{const{t:e}=(0,O.$G)();return(0,r.jsxs)($s,{children:[(0,r.jsxs)(Gs,{children:[(0,r.jsx)(Ms,{}),(0,r.jsx)(Es,{})]}),(0,r.jsx)(Us,{children:e("wallet_swap")})]})},Ks=l.zo.div(Bs||(Bs=(0,s.Z)(["\n    overflow-y: auto;\n    min-height: calc(var(--app-height) - 7rem);\n"]))),Ws=()=>(0,r.jsx)(Ks,{children:(0,r.jsx)(us,{})}),Ls=()=>{const[e,n]=(0,C.J)();return(0,r.jsx)(hs.SV,{fallbackRender:(0,xs.G)("Failed to display Swap page"),children:(0,r.jsx)(ne.P_,{isOpen:e,handleClose:()=>n(!1),title:(0,r.jsx)(Is,{}),children:()=>(0,r.jsx)(Ws,{})})})}},20504:(e,n,t)=>{t.d(n,{Iy:()=>S,L:()=>C,UE:()=>z,bB:()=>T,r7:()=>Z});var s=t(41235),r=t(11707),i=t(86445),a=t(14182),o=t(76978),l=t(39079),d=t(48544),c=t(24539),u=t(93853),p=t(27127),m=t(34692),h=t(72791),x=t(87594),g=t(23098),v=t(72119),f=t(97957),j=t(60793),w=t(7393),y=t(57443),b=t(94216),A=t(91153);function S(){const{swapService:e}=(0,b.W)(),{data:n}=_();return(0,s.useQuery)({queryKey:[f.S8.swapAllAssets,n],queryFn:async()=>{try{const t=await e.swapAssets();return t.map((e=>{const n="ton"===e.address?"TON":r.Address.parse(e.address);return{id:(0,l.G)(a.S.TON,n),symbol:e.symbol,decimals:e.decimals,name:e.name,image:e.image,blockchain:a.S.TON,address:n}})).filter((e=>!(n||[]).some((n=>n.id===e.id)))).concat(n||[])}catch(t){return console.error(t),[]}},enabled:!!n})}const k=(0,v.cn)("");function C(){return(0,v.KO)(k)}const Z=()=>{const[e]=C(),{data:n}=function(){const[e]=(0,j.Li)(),{data:n}=S(),{data:t}=(0,y.UJ)(a.C.TON),{fiat:i}=(0,x.bp)();return(0,s.useQuery)({queryKey:[f.S8.swapWalletAssets,n,e,t,i],queryFn:async()=>{if(!e||!n||!t)return[];const s=n.map((n=>{var s;if((0,d.kC)(n.address))return{assetAmount:new o.n({asset:n,weiAmount:e.ton.info.balance}),fiatAmount:(0,u.PE)(new m.Z(e.ton.info.balance)).multipliedBy(t.prices)};const a=e.ton.jettons.balances.find((e=>r.Address.parse(e.jetton.address).equals(n.address)));return{assetAmount:new o.n({asset:n,weiAmount:(null===a||void 0===a?void 0:a.balance)||0}),fiatAmount:(0,u.PE)(new m.Z((null===a||void 0===a?void 0:a.balance)||0),n.decimals).multipliedBy(new m.Z((null===a||void 0===a||null===(s=a.price)||void 0===s||null===(s=s.prices)||void 0===s?void 0:s[i])||0))}}));return s.sort(((e,n)=>e.fiatAmount.isZero()&&n.fiatAmount.isZero()?n.assetAmount.weiAmount.comparedTo(e.assetAmount.weiAmount):n.fiatAmount.comparedTo(e.fiatAmount))),s},enabled:!!e&&!!n&&!!t})}();return(0,h.useMemo)((()=>{if(n)return n.filter((n=>{var t;if(!e)return!0;if((0,p.Ig)(e))return r.Address.parse(e).equals(n.assetAmount.asset.address);const s=e.toUpperCase();return!!(n.assetAmount.asset.symbol.toUpperCase().includes(s)||null!==(t=n.assetAmount.asset.name)&&void 0!==t&&t.toUpperCase().includes(s))||void 0}))}),[e,n])},z=()=>{const[e]=C(),n=(0,p.Ig)(e),{fiat:t}=(0,x.bp)(),i=(0,A.jE)(),{data:d}=(0,w.NR)();return(0,s.useQuery)({queryKey:[f.S8.swapCustomToken,e,d,t],queryFn:async()=>{if(!n)return null;try{var s;const n=r.Address.parse(e),p=await new c.EkG(i.tonApiV2).getJettonInfo({accountId:n.toRawString()}),h={address:n,image:p.metadata.image,blockchain:a.S.TON,name:p.metadata.name,symbol:p.metadata.symbol,decimals:Number(p.metadata.decimals),id:(0,l.G)(a.S.TON,n)},x=null===d||void 0===d?void 0:d.balances.find((e=>r.Address.parse(e.jetton.address).equals(n)));return{assetAmount:new o.n({asset:h,weiAmount:(null===x||void 0===x?void 0:x.balance)||new m.Z(0)}),fiatAmount:(0,u.PE)(new m.Z((null===x||void 0===x?void 0:x.balance)||0),h.decimals).multipliedBy(new m.Z((null===x||void 0===x||null===(s=x.price)||void 0===s||null===(s=s.prices)||void 0===s?void 0:s[t])||0))}}catch(p){return console.error(p),null}},enabled:n&&!!d})},_=()=>{const e=(0,g._)();return(0,s.useQuery)([i.l.SWAP_CUSTOM_ASSETS],(async()=>{const n=await e.storage.get(i.l.SWAP_CUSTOM_ASSETS);return(null===n||void 0===n?void 0:n.map((e=>({...e,blockchain:e.blockchain,address:(0,d.Wx)(e.address),id:(0,l.G)(e.blockchain,e.address)}))))||[]}))},T=()=>{const e=(0,g._)(),n=(0,s.useQueryClient)();return(0,s.useMutation)((async t=>{const s=await e.storage.get(i.l.SWAP_CUSTOM_ASSETS)||[];await e.storage.set(i.l.SWAP_CUSTOM_ASSETS,[...s,{...t,address:(0,d.J)(t.address)}]),await n.invalidateQueries([i.l.SWAP_CUSTOM_ASSETS])}))}},59371:(e,n,t)=>{t.d(n,{SV:()=>a});var s=t(72791);const r=(0,s.createContext)(null),i={didCatch:!1,error:null};class a extends s.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=i}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var n,t,s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];null===(n=(t=this.props).onReset)||void 0===n||n.call(t,{args:r,reason:"imperative-api"}),this.setState(i)}}componentDidCatch(e,n){var t,s;null===(t=(s=this.props).onError)||void 0===t||t.call(s,e,n)}componentDidUpdate(e,n){const{didCatch:t}=this.state,{resetKeys:s}=this.props;var r,a;t&&null!==n.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==n.length||e.some(((e,t)=>!Object.is(e,n[t])))}(e.resetKeys,s)&&(null===(r=(a=this.props).onReset)||void 0===r||r.call(a,{next:s,prev:e.resetKeys,reason:"keys"}),this.setState(i))}render(){const{children:e,fallbackRender:n,FallbackComponent:t,fallback:i}=this.props,{didCatch:a,error:o}=this.state;let l=e;if(a){const e={error:o,resetErrorBoundary:this.resetErrorBoundary};if("function"===typeof n)l=n(e);else if(t)l=(0,s.createElement)(t,e);else{if(null!==i&&!(0,s.isValidElement)(i))throw o;l=i}}return(0,s.createElement)(r.Provider,{value:{didCatch:a,error:o,resetErrorBoundary:this.resetErrorBoundary}},l)}}}}]);
//# sourceMappingURL=106.b8124ab0.chunk.js.map