import{db as Te,o as Se,p as K}from"./chunk-LTUJMY6D.js";import{w as xe}from"./chunk-36Y64SHT.js";import{a as M,c as N,d as Ce}from"./chunk-IS26EKBL.js";import{a as Ye}from"./chunk-BTKBODVJ.js";import{D as we,E as _}from"./chunk-OX7Q6J2U.js";import{Na as P,Q as k,Xc as fe,Zc as A,ad as le,bd as me,cd as ge,dd as he,fd as ye,id as Re,qb as pe,ua as ce,uc as de}from"./chunk-MHD4HNLY.js";import{K as oe}from"./chunk-G3SOTMUM.js";import{Z as ue,v as q}from"./chunk-6E74REJW.js";import{Na as se,Oa as ie,Qa as ae,sa as S}from"./chunk-66TF6S77.js";import{c as D,d as Xe,f as v,h as c,m as Buffer,n as p}from"./chunk-3KENBVE7.js";var ke=D(y=>{"use strict";c();p();var Ae=y&&y.__classPrivateFieldGet||function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)},Ee=y&&y.__classPrivateFieldSet||function(e,t,r,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,r):o?o.value=r:t.set(e,r),r},T;Object.defineProperty(y,"__esModule",{value:!0});y.TokenData=void 0;y.parse=G;y.compile=ht;y.match=Rt;y.pathToRegexp=ve;y.stringify=St;var j="/",F=e=>e,be=/^[$_\p{ID_Start}]$/u,z=/^[$\u200c\u200d\p{ID_Continue}]$/u,B="https://git.new/pathToRegexpError",lt={"{":"{","}":"}","(":"(",")":")","[":"[","]":"]","+":"+","?":"?","!":"!"};function mt(e){return e.replace(/[{}()\[\]+?!:*]/g,"\\$&")}function E(e){return e.replace(/[.+*?^${}()[\]|/\\]/g,"\\$&")}function*gt(e){let t=[...e],r=0;function n(){let o="";if(be.test(t[++r]))for(o+=t[r];z.test(t[++r]);)o+=t[r];else if(t[r]==='"'){let s=r;for(;r<t.length;){if(t[++r]==='"'){r++,s=0;break}t[r]==="\\"?o+=t[++r]:o+=t[r]}if(s)throw new TypeError(`Unterminated quote at ${s}: ${B}`)}if(!o)throw new TypeError(`Missing parameter name at ${r}: ${B}`);return o}for(;r<t.length;){let o=t[r],s=lt[o];if(s)yield{type:s,index:r++,value:o};else if(o==="\\")yield{type:"ESCAPED",index:r++,value:t[r++]};else if(o===":"){let i=n();yield{type:"PARAM",index:r,value:i}}else if(o==="*"){let i=n();yield{type:"WILDCARD",index:r,value:i}}else yield{type:"CHAR",index:r,value:t[r++]}}return{type:"END",index:r,value:""}}var W=class{constructor(t){this.tokens=t,T.set(this,void 0)}peek(){if(!Ae(this,T,"f")){let t=this.tokens.next();Ee(this,T,t.value,"f")}return Ae(this,T,"f")}tryConsume(t){let r=this.peek();if(r.type===t)return Ee(this,T,void 0,"f"),r.value}consume(t){let r=this.tryConsume(t);if(r!==void 0)return r;let{type:n,index:o}=this.peek();throw new TypeError(`Unexpected ${n} at ${o}, expected ${t}: ${B}`)}text(){let t="",r;for(;r=this.tryConsume("CHAR")||this.tryConsume("ESCAPED");)t+=r;return t}};T=new WeakMap;var I=class{constructor(t){this.tokens=t}};y.TokenData=I;function G(e,t={}){let{encodePath:r=F}=t,n=new W(gt(e));function o(i){let u=[];for(;;){let f=n.text();f&&u.push({type:"text",value:r(f)});let m=n.tryConsume("PARAM");if(m){u.push({type:"param",name:m});continue}let g=n.tryConsume("WILDCARD");if(g){u.push({type:"wildcard",name:g});continue}if(n.tryConsume("{")){u.push({type:"group",tokens:o("}")});continue}return n.consume(i),u}}let s=o("END");return new I(s)}function ht(e,t={}){let{encode:r=encodeURIComponent,delimiter:n=j}=t,o=e instanceof I?e:G(e,t),s=De(o.tokens,n,r);return function(u={}){let[f,...m]=s(u);if(m.length)throw new TypeError(`Missing parameters: ${m.join(", ")}`);return f}}function De(e,t,r){let n=e.map(o=>yt(o,t,r));return o=>{let s=[""];for(let i of n){let[u,...f]=i(o);s[0]+=u,s.push(...f)}return s}}function yt(e,t,r){if(e.type==="text")return()=>[e.value];if(e.type==="group"){let o=De(e.tokens,t,r);return s=>{let[i,...u]=o(s);return u.length?[""]:[i]}}let n=r||F;return e.type==="wildcard"&&r!==!1?o=>{let s=o[e.name];if(s==null)return["",e.name];if(!Array.isArray(s)||s.length===0)throw new TypeError(`Expected "${e.name}" to be a non-empty array`);return[s.map((i,u)=>{if(typeof i!="string")throw new TypeError(`Expected "${e.name}/${u}" to be a string`);return n(i)}).join(t)]}:o=>{let s=o[e.name];if(s==null)return["",e.name];if(typeof s!="string")throw new TypeError(`Expected "${e.name}" to be a string`);return[n(s)]}}function Rt(e,t={}){let{decode:r=decodeURIComponent,delimiter:n=j}=t,{regexp:o,keys:s}=ve(e,t),i=s.map(u=>r===!1?F:u.type==="param"?r:f=>f.split(n).map(r));return function(f){let m=o.exec(f);if(!m)return!1;let g=m[0],h=Object.create(null);for(let R=1;R<m.length;R++){if(m[R]===void 0)continue;let x=s[R-1],L=i[R-1];h[x.name]=L(m[R])}return{path:g,params:h}}}function ve(e,t={}){let{delimiter:r=j,end:n=!0,sensitive:o=!1,trailing:s=!0}=t,i=[],u=[],f=o?"s":"is",g=(Array.isArray(e)?e:[e]).map(x=>x instanceof I?x:G(x,t));for(let{tokens:x}of g)for(let L of U(x,0,[])){let Je=xt(L,r,i);u.push(Je)}let h=`^(?:${u.join("|")})`;return s&&(h+=`(?:${E(r)}$)?`),h+=n?"$":`(?=${E(r)}|$)`,{regexp:new RegExp(h,f),keys:i}}function*U(e,t,r){if(t===e.length)return yield r;let n=e[t];if(n.type==="group"){let o=r.slice();for(let s of U(n.tokens,0,o))yield*U(e,t+1,s)}else r.push(n);yield*U(e,t+1,r)}function xt(e,t,r){let n="",o="",s=!0;for(let i=0;i<e.length;i++){let u=e[i];if(u.type==="text"){n+=E(u.value),o=u.value,s||(s=u.value.includes(t));continue}if(u.type==="param"||u.type==="wildcard"){if(!s&&!o)throw new TypeError(`Missing text after "${u.name}": ${B}`);u.type==="param"?n+=`(${wt(t,s?"":o)}+)`:n+="(.+)",r.push(u),o="",s=!1;continue}}return n}function wt(e,t){let r=[e,t].filter(Boolean);return r.every(o=>o.length===1)?`[^${E(r.join(""))}]`:`(?:(?!${r.map(E).join("|")}).)`}function St(e){return e.tokens.map(function t(r,n,o){if(r.type==="text")return mt(r.value);if(r.type==="group")return`{${r.tokens.map(t).join("")}}`;let i=Ct(r.name)&&Tt(o[n+1])?r.name:JSON.stringify(r.name);if(r.type==="param")return`:${i}`;if(r.type==="wildcard")return`*${i}`;throw new TypeError(`Unexpected token: ${r}`)}).join("")}function Ct(e){let[t,...r]=e;return be.test(t)?r.every(n=>z.test(n)):!1}function Tt(e){return e?.type!=="text"?!0:!z.test(e.value[0])}});var $=D(d=>{"use strict";c();p();Object.defineProperty(d,"__esModule",{value:!0});d.isHexString=d.getKeys=d.fromAscii=d.fromUtf8=d.toAscii=d.arrayContainsArray=d.getBinarySize=d.padToEven=d.stripHexPrefix=d.isHexPrefixed=void 0;function Oe(e){if(typeof e!="string")throw new Error(`[isHexPrefixed] input must be type 'string', received type ${typeof e}`);return e[0]==="0"&&e[1]==="x"}d.isHexPrefixed=Oe;var Ut=e=>{if(typeof e!="string")throw new Error(`[stripHexPrefix] input must be type 'string', received ${typeof e}`);return Oe(e)?e.slice(2):e};d.stripHexPrefix=Ut;function $e(e){let t=e;if(typeof t!="string")throw new Error(`[padToEven] value must be type 'string', received ${typeof t}`);return t.length%2&&(t=`0${t}`),t}d.padToEven=$e;function Bt(e){if(typeof e!="string")throw new Error(`[getBinarySize] method requires input type 'string', received ${typeof e}`);return Buffer.byteLength(e,"utf8")}d.getBinarySize=Bt;function Ot(e,t,r){if(Array.isArray(e)!==!0)throw new Error(`[arrayContainsArray] method requires input 'superset' to be an array, got type '${typeof e}'`);if(Array.isArray(t)!==!0)throw new Error(`[arrayContainsArray] method requires input 'subset' to be an array, got type '${typeof t}'`);return t[r===!0?"some":"every"](n=>e.indexOf(n)>=0)}d.arrayContainsArray=Ot;function $t(e){let t="",r=0,n=e.length;for(e.substring(0,2)==="0x"&&(r=2);r<n;r+=2){let o=parseInt(e.substr(r,2),16);t+=String.fromCharCode(o)}return t}d.toAscii=$t;function Ht(e){let t=Buffer.from(e,"utf8");return`0x${$e(t.toString("hex")).replace(/^0+|0+$/g,"")}`}d.fromUtf8=Ht;function Vt(e){let t="";for(let r=0;r<e.length;r++){let o=e.charCodeAt(r).toString(16);t+=o.length<2?`0${o}`:o}return`0x${t}`}d.fromAscii=Vt;function Lt(e,t,r){if(!Array.isArray(e))throw new Error(`[getKeys] method expects input 'params' to be an array, got ${typeof e}`);if(typeof t!="string")throw new Error(`[getKeys] method expects input 'key' to be type 'string', got ${typeof e}`);let n=[];for(let o=0;o<e.length;o++){let s=e[o][t];if(r===!0&&!s)s="";else if(typeof s!="string")throw new Error(`invalid abi - expected type 'string', received ${typeof s}`);n.push(s)}return n}d.getKeys=Lt;function _t(e,t){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||typeof t<"u"&&t>0&&e.length!==2+2*t)}d.isHexString=_t});var He=D(w=>{"use strict";c();p();Object.defineProperty(w,"__esModule",{value:!0});w.assertIsString=w.assertIsArray=w.assertIsBuffer=w.assertIsHexString=void 0;var Kt=$(),Wt=function(e){if(!(0,Kt.isHexString)(e)){let t=`This method only supports 0x-prefixed hex strings but input was: ${e}`;throw new Error(t)}};w.assertIsHexString=Wt;var jt=function(e){if(!Buffer.isBuffer(e)){let t=`This method only supports Buffer but input was: ${e}`;throw new Error(t)}};w.assertIsBuffer=jt;var Ft=function(e){if(!Array.isArray(e)){let t=`This method only supports number arrays but input was: ${e}`;throw new Error(t)}};w.assertIsArray=Ft;var zt=function(e){if(typeof e!="string"){let t=`This method only supports strings but input was: ${e}`;throw new Error(t)}};w.assertIsString=zt});var Ke=D(a=>{"use strict";c();p();Object.defineProperty(a,"__esModule",{value:!0});a.intToUnpaddedBuffer=a.bigIntToUnpaddedBuffer=a.bigIntToHex=a.bufArrToArr=a.arrToBufArr=a.validateNoLeadingZeroes=a.baToJSON=a.toUtf8=a.short=a.addHexPrefix=a.toUnsigned=a.fromSigned=a.bufferToInt=a.bigIntToBuffer=a.bufferToBigInt=a.bufferToHex=a.toBuffer=a.unpadHexString=a.unpadArray=a.unpadBuffer=a.setLengthRight=a.setLengthLeft=a.zeros=a.intToBuffer=a.intToHex=void 0;var b=He(),C=$(),Gt=function(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Received an invalid integer type: ${e}`);return`0x${e.toString(16)}`};a.intToHex=Gt;var Jt=function(e){let t=(0,a.intToHex)(e);return Buffer.from((0,C.padToEven)(t.slice(2)),"hex")};a.intToBuffer=Jt;var Xt=function(e){return Buffer.allocUnsafe(e).fill(0)};a.zeros=Xt;var Ve=function(e,t,r){let n=(0,a.zeros)(t);return r?e.length<t?(e.copy(n),n):e.slice(0,t):e.length<t?(e.copy(n,t-e.length),n):e.slice(-t)},Yt=function(e,t){return(0,b.assertIsBuffer)(e),Ve(e,t,!1)};a.setLengthLeft=Yt;var Zt=function(e,t){return(0,b.assertIsBuffer)(e),Ve(e,t,!0)};a.setLengthRight=Zt;var X=function(e){let t=e[0];for(;e.length>0&&t.toString()==="0";)e=e.slice(1),t=e[0];return e},Qt=function(e){return(0,b.assertIsBuffer)(e),X(e)};a.unpadBuffer=Qt;var er=function(e){return(0,b.assertIsArray)(e),X(e)};a.unpadArray=er;var tr=function(e){return(0,b.assertIsHexString)(e),e=(0,C.stripHexPrefix)(e),"0x"+X(e)};a.unpadHexString=tr;var rr=function(e){if(e==null)return Buffer.allocUnsafe(0);if(Buffer.isBuffer(e))return Buffer.from(e);if(Array.isArray(e)||e instanceof Uint8Array)return Buffer.from(e);if(typeof e=="string"){if(!(0,C.isHexString)(e))throw new Error(`Cannot convert string to buffer. toBuffer only supports 0x-prefixed hex strings and this string was given: ${e}`);return Buffer.from((0,C.padToEven)((0,C.stripHexPrefix)(e)),"hex")}if(typeof e=="number")return(0,a.intToBuffer)(e);if(typeof e=="bigint"){if(e<BigInt(0))throw new Error(`Cannot convert negative bigint to buffer. Given: ${e}`);let t=e.toString(16);return t.length%2&&(t="0"+t),Buffer.from(t,"hex")}if(e.toArray)return Buffer.from(e.toArray());if(e.toBuffer)return Buffer.from(e.toBuffer());throw new Error("invalid type")};a.toBuffer=rr;var nr=function(e){return e=(0,a.toBuffer)(e),"0x"+e.toString("hex")};a.bufferToHex=nr;function Y(e){let t=(0,a.bufferToHex)(e);return BigInt(t==="0x"?0:t)}a.bufferToBigInt=Y;function Z(e){return(0,a.toBuffer)("0x"+e.toString(16))}a.bigIntToBuffer=Z;var or=function(e){let t=Number(Y(e));if(!Number.isSafeInteger(t))throw new Error("Number exceeds 53 bits");return t};a.bufferToInt=or;var sr=function(e){return BigInt.asIntN(256,Y(e))};a.fromSigned=sr;var ir=function(e){return Z(BigInt.asUintN(256,e))};a.toUnsigned=ir;var ar=function(e){return typeof e!="string"||(0,C.isHexPrefixed)(e)?e:"0x"+e};a.addHexPrefix=ar;function ur(e,t=50){let r=Buffer.isBuffer(e)?e.toString("hex"):e;return r.length<=t?r:r.slice(0,t)+"\u2026"}a.short=ur;var cr=function(e){let t=/^(00)+|(00)+$/g;if(e=(0,C.stripHexPrefix)(e),e.length%2!==0)throw new Error("Invalid non-even hex string input for toUtf8() provided");return Buffer.from(e.replace(t,""),"hex").toString("utf8")};a.toUtf8=cr;var pr=function(e){if(Buffer.isBuffer(e))return`0x${e.toString("hex")}`;if(e instanceof Array){let t=[];for(let r=0;r<e.length;r++)t.push((0,a.baToJSON)(e[r]));return t}};a.baToJSON=pr;var dr=function(e){for(let[t,r]of Object.entries(e))if(r!==void 0&&r.length>0&&r[0]===0)throw new Error(`${t} cannot have leading zeroes, received: ${r.toString("hex")}`)};a.validateNoLeadingZeroes=dr;function Le(e){return Array.isArray(e)?e.map(t=>Le(t)):Buffer.from(e)}a.arrToBufArr=Le;function _e(e){return Array.isArray(e)?e.map(t=>_e(t)):Uint8Array.from(e??[])}a.bufArrToArr=_e;var fr=e=>"0x"+e.toString(16);a.bigIntToHex=fr;function lr(e){return(0,a.unpadBuffer)(Z(e))}a.bigIntToUnpaddedBuffer=lr;function mr(e){return(0,a.unpadBuffer)((0,a.intToBuffer)(e))}a.intToUnpaddedBuffer=mr});var Ie={};Xe(Ie,{any:()=>tt,cancelled:()=>ft,chainDisconnected:()=>rt,error:()=>et,internalError:()=>ot,invalidInput:()=>nt,methodNotFound:()=>st,rateLimited:()=>pt,resourceUnavailable:()=>it,result:()=>Qe,transactionRejected:()=>at,unauthorized:()=>ut,unsupportedMethod:()=>ct,userRejectedRequest:()=>dt});c();p();var Qe=(e,t)=>({jsonrpc:"2.0",id:e,result:t}),et=(e,t)=>({jsonrpc:"2.0",id:e,error:t}),tt=(e,t)=>({...t,jsonrpc:"2.0",id:e}),rt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4901,message:t??"The Provider is not connected to the requested chain."}}),nt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32e3,message:t??"Missing or invalid parameters."}}),ot=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32603,message:t??"Something went wrong."}}),st=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32601,message:t??"Method does not exist."}}),it=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32002,message:t??"Requested resource not available."}}),at=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32003,message:t??"Transaction creation failed."}}),ut=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4100,message:t??"The requested method and/or account has not been authorized by the user."}}),ct=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4200,message:t??"The requested method is not supported."}}),pt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4290,message:t??"The requested method has been rate limited."}}),dt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4001,message:t??"User rejected the request."}}),ft=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32800,message:t??"The request was cancelled."}});c();p();c();p();var qe=v(ke());function It(e,t){return{request:e,source:t,id:oe()}}function At(){return{parse(e){return Et(e)}}}function Et(e){function t(r,n,o){return async i=>{if(e.path&&i.source?.type==="DeepLinkRpcRequestSource"){let g=new URL(i.source.deepLinkUrl),h=g.host+g.pathname,x=(0,qe.match)(e.path)(h);x&&i.request.params&&typeof i.request.params=="object"&&(i.request.params={...i.request.params,...x.params})}let u={...i,request:e.request.parse(i.request)},f=[];for(let g of n){let h=await g(u,r);if(h){if(typeof h!="function")return setTimeout(()=>{for(let R of f)R(h)},0),h;f.push(h)}}let m=e.response.parse(await o(u,r));if(m.id!==i.request.id){let g="Request id does not match response id";throw console.error(g,{request:i.request,response:m}),new Error(g)}return setTimeout(()=>{for(let g of f)g(m)},0),m}}return{context(r){return{use:(n,o)=>t(r,n,o)}},use:(r,n)=>t(void 0,r,n)}}c();p();var J=class{#e;constructor(t){this.#e=t}init(t,r){let n=new AbortController,{signal:o}=n,s=bt(this.#e.routes,this.#e.concurrent);return{start:async()=>{if(o.aborted){console.warn("stream already closed");return}try{await t.pipeThrough(s,{signal:o}).pipeTo(r,{signal:o})}catch(i){o.aborted||console.error("RPC router stream error",i)}},stop:i=>{n.abort(i)}}}};function bt(e,t){return new TransformStream({async transform(r,n){let o=async()=>{let s=e[r.request.method];if(!s){let i={jsonrpc:"2.0",id:r.request.id,error:{code:0,message:`${r.request.method} isn't implemented`}};return n.enqueue([r,i])}try{let i=await s(r);return n.enqueue([r,i])}catch(i){console.error("RPC ROUTER: Unexpected error",i);let u={jsonrpc:"2.0",id:r.request.id,error:{code:-32603,message:"Unexpected error"}};return n.enqueue([r,u])}};t?o():await o()}})}c();p();c();p();var Pe=e=>{let t=new M,r=new ae({storage:t,getPassword:e}),n=ie.fromStorage(t,r),o=new ce,s=new he({keyPair:{solana:ge(),eip155:le(),bip122_p2tr:A(),bip122_p2wpkh:A(),bip122_p2sh:A(),bip122_p2pkh:A(),JWT:me()},ledger:xe(),seedVault:{type:"seedVault",async sign(){return fe("unsupportedOperation")}}}),i=()=>pe(t),u={generalStorage:t,secretsStorage:n,secureCache:ye({isEnabled:()=>!N("kill-vault-secure-cache"),generalStorage:t,secretsStorage:n}),fetchChainAvailability:i,keypairGenerator:o,vaultSigner:s};return{vault:Re(u),getChainAvailability:i,encryptedStorage:n,storageEncryptionKeyManager:r}};c();p();var Dt=/^\.phantom-labs\.vault\.seed\.[0-9A-Fa-f]+$/,vt=/^\.phantom-labs\.vault\.privateKey\.[0-9A-Fa-f]+$/;async function Ne(e){let t;try{if(t=await e.storageEncryptionKeyManager.hasPersistedDeviceEncryptionKey(),!t)return{status:"noMiddleEncryptionKey"}}catch{return{status:"errorRetrievingMiddleEncryptionKey"}}let r;try{r=(await e.vault.checkVaultIntegrity()).status}catch{return{status:"errorUnableToCheckVaultIntegrity"}}try{let n=await e.generalStorage.getAll(),[o,s]=await Me(e,n,Dt),[i,u]=await Me(e,n,vt);return{status:"hasMiddleEncryptionKey",vaultStatus:r,numberOfEncryptedSeeds:o,numberOfDecryptableSeeds:s,numberOfEncryptedPrivateKeys:i,numberOfDecryptablePrivateKeys:u}}catch{return{status:"errorUnableToCountDecryptableValues",vaultStatus:r}}}async function Me(e,t,r){let n=0,o=0;for(let[s,i]of Object.entries(t))if(!(!s.match(r)||!se.safeParse(i).success)){n++;try{await e.secretsStorage.getSecureValue(s),o++}catch{}}return[n,o]}var ln="HAS_ONBOARDING_BEEN_OPENED",mn="EXTENSION_LOCKED",O=null,gn=()=>O,Pt=e=>{O=e},hn=()=>{O=null},Mt=()=>O??null,{vault:Ue,getChainAvailability:yn,encryptedStorage:Nt,storageEncryptionKeyManager:Be}=Pe(Mt),Rn=async e=>!e||!await S.startSpan({name:"storageEncryptionKeyManager.verifyPassword"},()=>Be.verifyPassword(e))?!1:(Pt(e),!0),xn=async()=>{let e=await Ue.deriveAddresses();return e&&(S.addBreadcrumb("account","\u2705 Derived new addresses in Vault","info"),await Te.invalidateQueries({refetchType:"all"})),e},wn=async()=>{if(!N("kill-extension-storage-integrity-check"))try{let e=await Ne({generalStorage:new M,secretsStorage:Nt,storageEncryptionKeyManager:Be,vault:Ue});Ce.capture("extensionStorageIntegrityCheck",{data:{extensionStorageIntegrityCheck:e}})}catch{}};c();p();var Q=v(Ke()),We=v($()),gr=/^[0-9A-Fa-f]+$/gu;function je(e){try{let t=(0,We.stripHexPrefix)(e);if(t.match(gr))return hr(t)}catch{return(0,Q.bufferToHex)(Buffer.from(e,"utf8"))}return(0,Q.bufferToHex)(Buffer.from(e,"utf8"))}var hr=e=>typeof e!="string"||e.match(/^-?0x/u)?e:e.match(/^-?0X/u)?e.replace("0X","0x"):e.startsWith("-")?e.replace("-","-0x"):`0x${e}`,yr=e=>{let t=Buffer.from(e.substring(2),"hex"),r=t.length===32?"hex":"utf8",n;switch(r){case"hex":n=je(e);break;case"utf8":default:n=t.toString("utf8")}return n};c();p();c();p();var ee=v(Ye()),Vn=async e=>{let t=await ee.default.tabs.get(e);if(!t?.url?.startsWith("http"))return{iconUrl:void 0,title:void 0};let r=await Rr(e);return{iconUrl:r?.iconUrl??t?.favIconUrl,title:r?.title??t?.title}},Rr=async e=>{try{let r=(await ee.default.scripting.executeScript({target:{tabId:e},func:()=>{let s={},i=document.querySelectorAll("head link[rel^=apple-touch-icon]");i&&(s.iconTuples=Array.from(i).map(f=>[f.href,f.sizes?.[0]??"0x0"]));let u=document.querySelector("meta[property='og:title']");return u&&(s.title=u.content),s}}))[0].result;if(!r)return{iconUrl:void 0,title:void 0};let n,o=0;for(let[s,i]of r.iconTuples??[]){if(n||(n=s),!i)continue;parseInt(i.split("x")[0]??0)>o&&(n=s)}return{title:r.title,iconUrl:n}}catch(t){return console.error("Failed to get tab meta",t),{iconUrl:void 0,title:void 0}}};c();p();var wr={UNSUPPORTED_DAPP:"autoConfirmReasonDappNotWhitelisted",DISABLED:"autoConfirmReasonSessionNotActive",RATE_LIMIT_EXCEEDED:"autoConfirmReasonRateLimited",SIMULATION_FAILED:"autoConfirmReasonSimulationFailed",UNSUPPORTED_NETWORK_ID:"autoConfirmReasonUnsupportedNetwork",TAB_NOT_FOCUSED:"autoConfirmReasonTabNotFocused",WALLET_LOCKED:"autoConfirmReasonNotUnlocked"},Sr=e=>e?wr[e]:void 0;c();p();c();p();c();p();var te=e=>`/auto-confirm/v1/${e}`;async function re(e){return P.isEVMNetworkID(e.chainId)?(await k.api().post(te("transaction"),{txObjects:e.txObjects,chainId:e.chainId,domain:e.domain})).data?.isEligible===!0:P.isSolanaNetworkID(e.chainId)?(await k.api().post(te("transaction"),{transactions:e.transactions,chainId:e.chainId,domain:e.domain})).data?.isEligible===!0:!1}async function Fe(e){if(P.isEVMNetworkID(e.chainId)){let t=JSON.parse(JSON.stringify(e.data));return delete t.message,delete t.primaryType,delete t.types,(await(await k.api().post(te("message"),{chainId:e.chainId,domain:e.domain,data:[t]})).data)?.isEligible===!0}return!1}var Cr=10,H=[],ne=class{constructor(t){this.storage=t;this.executedChecksAudit=[]}async isEthTransactionAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!=="OK")return n;if(!(await this.isDappWhitelistOverridden()||await re({chainId:t.networkID,domain:q(t.url.origin),txObjects:t.data})))return{...n,status:"UNSUPPORTED_DAPP",auditTrail:this.executedChecksAudit};let{success:s,...i}=await this.didPassEthTransactionSimulation(t,r);return s?{...n,...i,status:"OK",auditTrail:this.executedChecksAudit}:{...n,...i,status:"SIMULATION_FAILED",auditTrail:this.executedChecksAudit}}async isEthMessageAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);return n.status!=="OK"?n:await this.isDappWhitelistOverridden()||await Fe({chainId:t.networkID,domain:q(t.url.origin),data:t.data})?await this.didPassEthMessageSimulation(t,r)?{...n,status:"OK",auditTrail:this.executedChecksAudit}:{...n,status:"SIMULATION_FAILED",auditTrail:this.executedChecksAudit}:{...n,status:"UNSUPPORTED_DAPP",auditTrail:this.executedChecksAudit}}async isSolTransactionAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!=="OK")return n;if(!(await this.isDappWhitelistOverridden()||await re({chainId:t.networkID,domain:q(t.url.origin),transactions:t.data})))return{...n,status:"UNSUPPORTED_DAPP",auditTrail:this.executedChecksAudit};let{success:s,...i}=await this.didPassSolTransactionSimulation(t,r);return s?{...n,...i,status:"OK",auditTrail:this.executedChecksAudit}:{...n,...i,status:"SIMULATION_FAILED",auditTrail:this.executedChecksAudit}}isSolMessageAutoConfirmable(t){return this.executedChecksAudit=[],Promise.resolve({status:"UNIMPLEMENTED"})}async didPassGenericChecks(t){try{if(!await this.isFeatureEnabled())return{status:"FEATURE_KILLED"};if(!await this.isWalletUnlocked())return{status:"WALLET_LOCKED"};if(!await this.isTabFocused(t.url.origin))return{status:"TAB_NOT_FOCUSED"};if(!await this.isAutoConfirmEnabledInUserSettings({origin:t.url.origin,networkID:t.networkID,accountIdentifier:t.accountIdentifier}))return{status:"DISABLED"};let r=await this.isAutoConfirmSessionActive(t.accountIdentifier,t.url.origin);return r.success?await this.isNotRateLimited()?{status:"OK",sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}:{status:"RATE_LIMIT_EXCEEDED",sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}:{status:"SESSION_EXPIRED",sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}}catch{return{status:"UNKNOWN"}}}async isAutoConfirmEnabledInUserSettings({origin:t,accountIdentifier:r,networkID:n}){return this.executedChecksAudit.push("IS_AUTO_CONFIRM_ENABLED_IN_USER_SETTINGS"),(await _(this.storage,r,t))?.networks?.[n]===!0}isNotRateLimited(){this.executedChecksAudit.push("IS_NOT_RATE_LIMITED");let t=H.findIndex(r=>r<=Date.now()-6e4);return t>-1&&H.splice(t),H.length>=Cr?!1:(H.push(Date.now()),!0)}async isAutoConfirmSessionActive(t,r){this.executedChecksAudit.push("IS_AUTO_CONFIRM_SESSION_ACTIVE");let n=await _(this.storage,t,r),o=we(n);return{sessionStartTime:n.sessionStartTime,sessionMaxDuration:n.maxSessionDuration,success:o}}async didPassEthTransactionSimulation(t,r){this.executedChecksAudit.push("DID_PASS_ETH_TRANSACTION_SIMULATION");try{let n=await K(r.locale,r.deviceId,{networkID:t.networkID,type:"transaction",url:t.url?.href,userAccount:t.userAccountAddress,params:{transactions:t.data,userAddresses:[]}});return ze(n)}catch{return{success:!1}}}async didPassSolTransactionSimulation(t,r){this.executedChecksAudit.push("DID_PASS_SOL_TRANSACTION_SIMULATION");try{let n=await K(r.locale,r.deviceId,{networkID:t.networkID,type:"transaction",url:t.url.href,userAccount:t.userAccountAddress,params:{transactions:t.data,method:"signAndSendTransaction"}});return ze(n)}catch{return{success:!1}}}async didPassEthMessageSimulation(t,r){this.executedChecksAudit.push("DID_PASS_ETH_MESSAGE_SIMULATION");try{let n=await Se(r.locale,r.deviceId,{params:{message:"0x"+Buffer.from(JSON.stringify(t.data)).toString("hex")},type:"message",userAccount:t.userAccountAddress,networkID:t.networkID,url:t.url?.href});return Tr(n)}catch{return!1}}};function ze(e){let t=!!e.warnings.find(o=>o.severity<=3),r=!!e.block,n=e.expectedChanges.map(o=>o.type==="AssetChange"&&o.asset.usdValue||0).reduce((o,s)=>o+s,0);return{success:!t&&!r&&!e.error,dollarValue:parseFloat((n||0).toFixed(6))}}function Tr(e){let t=!!e.warnings.find(n=>n.severity<=3),r=!!e.block;return!t&&!r&&!e.error}c();p();var Ge=7,lo=ue(de,e=>new V(e)),V=class{#e;constructor(t){this.#e=t}onAutoConfirmSettingsChanged({origin:t,networkID:r,enabled:n,sessionStartTime:o,maxSessionDuration:s,view:i}){S.addBreadcrumb(`Auto-Confirm: ${n?"Enabling":"Disabling"} network ID ${r}`,"autoConfirm","info"),this.#e.capture("autoConfirmSettingsChanged",{data:{origin:t,networkId:r,enabled:n,sessionStartTime:n?o:void 0,maxSessionDuration:n?s:void 0,view:i}})}transactionAutoConfirmed(t){let r={type:"transaction",data:t};return t.autoConfirm.auditTrail?.length&&t.autoConfirm.auditTrail.length<Ge&&(t.autoConfirm.suspectSettingsTamper=!0),S.addBreadcrumb(`Auto-Confirm: transaction on origin ${t.origin} for network ${t.networkId} auto-confirmed`,"autoConfirm","info"),t.autoConfirm.suspectSettingsTamper&&S.addBreadcrumb("Auto-Confirm: suspected tampering with settings...","autoConfirm","info"),this.#e.capture("transactionAutoConfirmed",r)}messageAutoConfirmed(t){let r={type:"message",data:t};return t.autoConfirm.auditTrail?.length&&t.autoConfirm.auditTrail.length<Ge&&(t.autoConfirm.suspectSettingsTamper=!0),S.addBreadcrumb(`Auto-Confirm: message on origin ${t.origin} for network ${t.networkId} auto-confirmed`,"autoConfirm","info"),t.autoConfirm.suspectSettingsTamper&&S.addBreadcrumb("Auto-Confirm: suspected tampering with settings...","autoConfirm","info"),this.#e.capture("transactionAutoConfirmed",r)}};export{It as a,At as b,J as c,Ie as d,ln as e,mn as f,gn as g,Pt as h,hn as i,Ue as j,yn as k,Nt as l,Be as m,Rn as n,xn as o,wn as p,ne as q,lo as r,V as s,Sr as t,je as u,yr as v,Vn as w,Rr as x};
//# sourceMappingURL=chunk-3SJSJEWV.js.map
